<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asthro - Contato</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@400;600&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <style>
        /* Reset para box-sizing global */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        html, body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1e293b, #2d3748, #000000, #0f172a, #1e293b, #2d3748, #000000, #0f172a);
            background-size: 400% 400%;
            animation: gradientTransition 20s ease-in-out infinite;
            color: #f8f8f8;
            margin: 0;
            padding: 0;
            position: relative;
            overflow-x: hidden; /* Garante que não haja rolagem horizontal */
            overflow-y: auto; /* Permite rolagem vertical */
            min-height: 100%;
            width: 100vw; /* Garante que o body ocupe exatamente 100% da largura da viewport */
        }

        @keyframes gradientTransition {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .stars-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: #ffffff;
            border-radius: 50%;
            box-shadow: 0 0 5px 1px rgba(255, 255, 255, 0.5);
            opacity: 0.3;
            animation: floatStar 15s infinite ease-in-out;
        }

        .star.purple {
            background: #6a0dad;
            box-shadow: 0 0 5px 1px rgba(106, 13, 173, 0.5);
        }

        .star.pink {
            background: #e879f9;
            box-shadow: 0 0 5px 1px rgba(232, 121, 249, 0.5);
        }

        .star.white {
            background: #ffffff;
            box-shadow: 0 0 5px 1px rgba(255, 255, 255, 0.5);
        }

        @keyframes floatStar {
            0% { opacity: 0.3; transform: translate(0, 0); }
            50% { opacity: 0.6; transform: translate(var(--move-x), var(--move-y)); }
            100% { opacity: 0.3; transform: translate(0, 0); }
        }

        .brand-name {
            font-family: 'Great Vibes', cursive;
            line-height: 2;
            padding: 1rem;
            display: block;
            overflow: visible;
            font-size: clamp(2rem, 6vw, 2.5rem);
        }

        .flex.items-center.content-layer {
            overflow: visible;
        }

        .nav-link {
            font-family: 'Montserrat', sans-serif;
            position: relative;
            text-decoration: none;
            color: #f8f8f8;
            transition: color 0.3s ease;
            font-size: clamp(1rem, 3vw, 1.125rem);
        }

        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -4px;
            left: 0;
            background: linear-gradient(135deg, #a5b4fc, #e879f9);
            transition: width 0.3s ease;
        }

        .nav-link:hover::after {
            width: 100%;
        }

        .nav-link:hover {
            color: #e879f9;
        }

        .gradient-text {
            background: linear-gradient(135deg, #a5b4fc, #e879f9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        nav {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 10;
            background: transparent;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 0 1rem;
        }

        nav > div {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        nav .flex.items-center.content-layer:first-child {
            margin-right: auto;
        }

        nav .flex.items-center.content-layer:last-child {
            margin-left: auto;
        }

        nav, section, footer {
            position: relative;
            z-index: 1;
            /* pointer-events: none; - removido para interações com elementos que não são modais */
        }

        /* Remova esta regra ou ajuste se precisar de pointer-events específicos */
        /* nav *, section *, footer * {
            pointer-events: auto;
        } */

        .content-layer {
            position: relative;
            z-index: 2;
        }

        h1, h2, h3, p, a, input, textarea, button, img, svg {
            position: relative;
            z-index: 30;
            opacity: 1 !important;
        }

        h2, h3 {
            color: #f8f8f8;
            text-align: center;
            opacity: 0; /* Controlado por JS */
        }

        .cursive-text {
            font-family: 'Great Vibes', cursive;
            font-size: 2rem;
            line-height: 1.4;
            color: #e2e8f0;
        }

        .animated-gradient-text {
            background: linear-gradient(90deg, #6a0dad, #ffffff, #e879f9, #6a0dad);
            background-size: 400% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientShift 8s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes slideInLeftPiece {
            from { opacity: 0; transform: translateX(-50px) rotate(-5deg); }
            to { opacity: 1; transform: translateX(0) rotate(0); }
        }

        @keyframes slideOutLeftPiece {
            from { opacity: 1; transform: translateX(0) rotate(0); }
            to { opacity: 0; transform: translateX(-50px) rotate(-5deg); }
        }

        @keyframes slideInRightPiece {
            from { opacity: 0; transform: translateX(50px) rotate(5deg); }
            to { opacity: 1; transform: translateX(0) rotate(0); }
        }

        @keyframes slideOutRightPiece {
            from { opacity: 1; transform: translateX(0) rotate(0); }
            to { opacity: 0; transform: translateX(50px) rotate(5deg); }
        }

        @keyframes slideInTopPiece {
            from { opacity: 0; transform: translateY(-30px) rotate(-3deg); }
            to { opacity: 1; transform: translateY(0) rotate(0); }
        }

        @keyframes slideInBottomPiece {
            from { opacity: 0; transform: translateY(30px) rotate(3deg); }
            to { opacity: 1; transform: translateY(0) rotate(0); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .puzzle-piece {
            opacity: 0;
            display: inline-block;
        }

        .puzzle-piece-left {
            animation: slideInLeftPiece 0.8s ease-out forwards;
        }

        .puzzle-piece-left-exit {
            animation: slideOutLeftPiece 0.8s ease-out forwards;
        }

        .puzzle-piece-right {
            animation: slideInRightPiece 0.8s ease-out forwards;
        }

        .puzzle-piece-right-exit {
            animation: slideOutRightPiece 0.8s ease-out forwards;
        }

        .puzzle-piece-top {
            animation: slideInTopPiece 0.8s ease-out forwards;
        }

        .puzzle-piece-bottom {
            animation: slideInBottomPiece 0.8s ease-out forwards;
        }

        .float-effect {
            animation: float 3s infinite ease-in-out;
        }

        .puzzle-section {
            position: relative;
            background: #2d3748;
            border-radius: 1rem;
            padding: 2rem;
            margin: 2rem auto;
            max-width: 800px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            border: 2px solid #a5b4fc;
            animation: squish 30s infinite ease-in-out;
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }

        .puzzle-section:hover {
            background: #374151;
            box-shadow: 0 10px 20px rgba(106, 13, 173, 0.3);
        }

        .puzzle-section::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            width: 40px;
            height: 20px;
            background: #2d3748;
            border: 2px solid #a5b4fc;
            border-bottom: none;
            border-radius: 50% 50% 0 0;
            transform: translateX(-50%);
        }

        .puzzle-section::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            width: 40px;
            height: 20px;
            background: #2d3748;
            border: 2px solid #a5b4fc;
            border-top: none;
            border-radius: 0 0 50% 50%;
            transform: translateX(-50%);
        }

        .puzzle-section:hover::before,
        .puzzle-section:hover::after {
            background: #374151;
        }

        @keyframes squish {
            0% { transform: scale(1, 1); }
            20% { transform: scale(1.05, 0.95); }
            40% { transform: scale(0.95, 1.05); }
            60% { transform: scale(1.03, 0.97); }
            80% { transform: scale(0.97, 1.03); }
            100% { transform: scale(1, 1); }
        }

        .whatsapp-button, .form-button, .schedule-button, .feedback-button, .testimonial-button {
            display: inline-block;
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 2rem;
            font-size: 0.9rem;
            font-weight: bold;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .whatsapp-button { background: #25D366; }
        .form-button { background: #a78bfa; }
        .schedule-button { background: #1e3a8a; }
        .feedback-button { background: #be185d; }
        .testimonial-button { background: #166534; }

        .whatsapp-button:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(37, 211, 102, 0.5); }
        .form-button:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(167, 139, 250, 0.5); }
        .schedule-button:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(30, 58, 138, 0.5); }
        .feedback-button:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(190, 24, 93, 0.5); }
        .testimonial-button:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(22, 101, 52, 0.5); }

        /* Buttons inside puzzle-section: remove specific margins, use flex for spacing */
        .puzzle-section .whatsapp-button,
        .puzzle-section .form-button,
        .puzzle-section .schedule-button,
        .puzzle-section .feedback-button,
        .puzzle-section .testimonial-button {
            margin-right: 0;
            margin-left: 0;
        }

        .testimonial-carousel {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 150px;
            margin: 0 auto;
        }

        .testimonial-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .testimonial-slide.active {
            opacity: 1;
        }

        .testimonial-card {
            background: #374151;
            border-radius: 1rem;
            padding: 1.5rem;
            border: 2px solid #a5b4fc;
            text-align: center;
            color: #e2e8f0;
            width: 100%;
        }

        .testimonial-card p {
            font-size: 1.1rem;
            color: #e2e8f0;
            margin-bottom: 10px;
        }

        .testimonial-card .client-name {
            color: #e2e8f0;
            font-style: italic;
            font-weight: 600;
        }

        section p {
            text-align: center;
        }

        footer p {
            text-align: center;
        }

        .chat-container {
            max-width: 600px;
            margin: 0 auto;
            background: #374151;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            height: 500px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .chat-container.success {
            background: transparent;
            padding: 0;
            border-radius: 0;
            box-shadow: none;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            max-width: 70%;
            padding: 0.75rem;
            border-radius: 0.75rem;
            line-height: 1.5;
        }

        .bot-message {
            background: #4b5563;
            color: #e2e8f0;
            align-self: flex-start;
            border-bottom-left-radius: 0;
        }

        .user-message {
            background: #a5b4fc;
            color: #1f2937;
            align-self: flex-end;
            border-bottom-right-radius: 0;
        }

        .typing-indicator {
            display: flex;
            gap: 0.3rem;
            align-self: flex-start;
            padding: 0.75rem;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: #a5b4fc;
            border-radius: 50%;
            animation: bounce 0.6s infinite alternate;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-5px); }
        }

        .chat-input {
            display: flex;
            gap: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #4b5563;
            flex-wrap: nowrap; /* Impede a quebra de linha dos inputs no chat */
        }

        .chat-input textarea {
            flex: 1;
            padding: 0.75rem;
            background: #4b5563;
            color: #e2e8f0;
            border: 1px solid #a5b4fc;
            border-radius: 0.5rem;
            outline: none;
            resize: none;
            font-family: 'Poppins', sans-serif;
            font-size: clamp(0.875rem, 3vw, 1rem);
            min-width: 0; /* Permite que o textarea diminua */
        }

        .chat-input button {
            background: #e879f9;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            font-size: clamp(0.875rem, 3vw, 1rem);
        }

        .chat-input button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(232, 121, 249, 0.5);
        }

        .sparkle-text {
            font-size: clamp(1.5rem, 5vw, 2rem);
            font-weight: bold;
            text-align: center;
            color: #e2e8f0;
            background: linear-gradient(90deg, #a5b4fc, #e879f9, #a5b4fc);
            background-size: 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: sparkle 2s infinite, fadeIn 0.5s ease-in-out;
        }

        .success-message-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            min-height: 300px;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999; /* Z-INDEX MUITO ALTO PARA GARANTIR QUE FIQUE ACIMA DE TUDO */
            display: none;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .modal-overlay.show {
            display: flex;
            animation: fadeIn 0.3s ease-in-out;
        }

        .modal-content {
            background: #2d3748;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            border: 2px solid #a5b4fc;
            position: relative;
            animation: slideInTopPiece 0.5s ease-out;
            box-sizing: border-box;
            margin: auto;
            max-height: 90vh; /* Limita a altura máxima do modal */
            overflow-y: auto; /* Adiciona rolagem se o conteúdo for maior que a altura máxima */
        }

        /* **Ajuste específico para o modal de agendamento** */
        #scheduleModal .modal-content {
            position: relative; /* Mantém relative, a questão do z-index está no overlay */
            top: auto; /* Garante que top não seja herdado de forma estranha */
            left: auto; /* Garante que left não seja herdado de forma estranha */
            transform: none; /* Garante que transform não seja herdado de forma estranha */
            max-height: calc(100vh - 4rem); /* Ajuste mais preciso para evitar que o modal seja cortado */
            margin: 2rem auto; /* Centraliza verticalmente e horizontalmente */
        }


        .modal-content input,
        .modal-content textarea {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1rem;
            background: #4b5563;
            color: #e2e8f0;
            border: 1px solid #a5b4fc;
            border-radius: 0.5rem;
            outline: none;
            font-family: 'Poppins', sans-serif;
            font-size: clamp(0.9rem, 3.5vw, 1rem);
        }

        .modal-content textarea {
            resize: vertical;
            min-height: 100px;
        }

        .modal-content .form-button { /* Alvo apenas os botões de submit DENTRO do modal */
            background: #e879f9;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: none;
            width: 100%; /* Botão ocupa 100% da largura no modal */
            font-size: clamp(0.9rem, 3.5vw, 1rem);
        }

        .modal-content .form-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(232, 121, 249, 0.5);
        }

        .close-button {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: none;
            border: none;
            color: #e2e8f0;
            font-size: 1.5rem; /* Tamanho do "X" */
            cursor: pointer;
            padding: 0.2rem;
            line-height: 1;
            width: 30px; /* Largura fixa para o botão */
            height: 30px; /* Altura fixa para o botão */
            display: flex; /* Para centralizar o "X" dentro do botão */
            align-items: center;
            justify-content: center;
            border-radius: 50%; /* Faz o botão ser circular, se desejar */
            transition: background 0.2s ease, color 0.2s ease;
        }

        .close-button:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #e879f9;
        }

        .error-message,
        .success-message {
            text-align: center;
            margin-top: 1rem;
            font-size: clamp(0.85rem, 3.5vw, 0.9rem);
        }

        .error-message { color: #f87171; }
        .success-message { color: #a5b4fc; }

        @keyframes sparkle {
            0% { background-position: 0%; }
            50% { background-position: 200%; }
            100% { background-position: 0%; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* --- Mobile Responsiveness --- */

        /* Hamburger menu styles */
        .hamburger {
            display: none;
            flex-direction: column;
            justify-content: space-around;
            width: 2rem;
            height: 2rem;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
            z-index: 40;
        }

        .hamburger span {
            width: 100%;
            height: 3px;
            background: #f8f8f8;
            transition: all 0.3s ease;
        }

        .hamburger.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }

        .hamburger.active span:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -7px);
        }

        /* Nav menu for mobile */
        .nav-menu-mobile {
            display: none; /* Escondido por padrão, exibido via JS */
        }

        @media (max-width: 768px) {
            /* Navbar adjustments */
            nav {
                background: rgba(31, 41, 55, 0.95);
                padding: 0.5rem 1rem;
            }

            /* Hide desktop nav links */
            nav .flex.items-center.space-x-6 {
                display: none;
            }

            /* Show hamburger */
            .hamburger {
                display: flex;
            }

            /* Mobile nav menu com Glassmorphism */
            .nav-menu-mobile {
                position: fixed;
                top: 0;
                right: -100%;
                height: 100vh;
                width: 100%;
                max-width: 300px;
                background: rgba(31, 41, 55, 0.8); /* Fundo semi-transparente para o glassmorphism */
                backdrop-filter: blur(10px); /* Efeito de desfoque */
                -webkit-backdrop-filter: blur(10px); /* Para compatibilidade com Safari */
                border-left: 1px solid rgba(165, 180, 252, 0.3); /* Borda sutil */
                flex-direction: column;
                justify-content: center;
                align-items: center;
                gap: 1.5rem; /* Espaçamento entre os itens */
                transition: right 0.3s ease;
                z-index: 30;
                display: flex; /* Exibido via JS quando ativo */
                box-sizing: border-box;
                padding: 0 1rem;
                box-shadow: -5px 0 15px rgba(0, 0, 0, 0.3); /* Sombra para profundidade */
            }

            .nav-menu-mobile.active {
                right: 0;
            }

            /* Adjust brand name font size */
            .brand-name {
                font-size: clamp(1.75rem, 8vw, 2rem);
                padding: 0.5rem;
            }

            /* Estilo dos links no menu mobile - Glassmorphism */
            .nav-menu-mobile .nav-link {
                display: block;
                width: 90%; /* Ajuste a largura para um visual mais elegante */
                padding: 0.8rem 1.5rem;
                border-radius: 0.75rem; /* Mais arredondado */
                background: rgba(165, 180, 252, 0.1); /* Fundo semi-transparente para o link */
                color: #f8f8f8; /* Cor do texto clara */
                text-align: center;
                font-size: clamp(1.125rem, 4vw, 1.3rem); /* Fonte um pouco maior */
                font-weight: 600; /* Mais negrito */
                border: 1px solid rgba(255, 255, 255, 0.2); /* Borda sutil para o efeito de vidro */
                backdrop-filter: blur(5px);
                -webkit-backdrop-filter: blur(5px);
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* Sombra suave */
                transition: all 0.3s ease; /* Transições suaves */
            }

            .nav-menu-mobile .nav-link:hover {
                background: linear-gradient(135deg, rgba(165, 180, 252, 0.3), rgba(232, 121, 249, 0.3)); /* Gradiente mais visível no hover */
                transform: translateY(-4px) scale(1.02); /* Efeito de levantar e expandir levemente */
                box-shadow: 0 8px 16px rgba(232, 121, 249, 0.4); /* Sombra mais intensa e colorida no hover */
                border-color: #e879f9; /* Borda colorida no hover */
            }

            .nav-menu-mobile .nav-link::after {
                display: none; /* Remove a linha inferior dos links no mobile */
            }

            /* Main padding to account for fixed navbar */
            section.py-32 {
                padding-top: 8rem;
                padding-bottom: 4rem;
            }
            section.py-20 {
                padding-top: 3rem;
                padding-bottom: 3rem;
            }

            /* Titles and paragraphs */
            h2 {
                font-size: clamp(2.25rem, 9vw, 3rem);
                line-height: 1.2;
            }

            p {
                font-size: clamp(1rem, 4.5vw, 1.25rem);
            }

            .cursive-text {
                font-size: clamp(1.5rem, 6vw, 1.8rem);
            }

            /* Puzzle pieces text */
            .puzzle-piece {
                display: block;
                margin-bottom: 0.5rem;
                animation-delay: 0s !important;
            }
            .puzzle-piece:last-child {
                margin-bottom: 0;
            }

            /* Puzzle sections (cards) */
            .puzzle-section {
                padding: 1.5rem;
                margin: 1.5rem auto;
                width: 95%;
                max-width: 100%;
            }
            .puzzle-section::before,
            .puzzle-section::after {
                width: 30px;
                height: 15px;
            }

            /* Chat container */
            .chat-container {
                height: 400px;
                padding: 1rem;
                width: 100%;
                max-width: 100%;
            }

            .chat-messages {
                padding: 0.5rem;
                gap: 0.75rem;
            }

            .message {
                max-width: 85%;
                padding: 0.6rem;
                font-size: clamp(0.85rem, 3.5vw, 0.95rem);
            }

            .typing-indicator span {
                width: 6px;
                height: 6px;
            }

            .chat-input {
                gap: 0.5rem;
                padding-top: 0.75rem;
                flex-wrap: nowrap;
            }

            .chat-input textarea {
                font-size: clamp(0.85rem, 3.5vw, 0.95rem);
                padding: 0.6rem;
            }

            .chat-input button {
                font-size: clamp(0.85rem, 3.5vw, 0.95rem);
                padding: 0.6rem 1rem;
            }

            /* Modal adjustments */
            .modal-overlay {
                padding: 1rem;
            }

            .modal-content {
                padding: 1.5rem;
                width: 100%;
                max-width: 400px; /* Mantém um limite razoável para o tamanho do modal */
                max-height: 95vh; /* Ajuste para mobile para que o modal não fique tão alto */
            }
            /* Ajuste específico para o modal de agendamento em mobile */
            #scheduleModal .modal-content {
                max-height: calc(100vh - 4rem); /* Ajuste mais preciso para evitar que o modal seja cortado, mantendo margens */
            }

            .modal-content input,
            .modal-content textarea,
            .modal-content .form-button { /* Alvo específico para botões de formulário no modal */
                font-size: clamp(0.9rem, 3.8vw, 1rem);
                padding: 0.6rem;
            }
            .modal-content textarea {
                min-height: 80px;
            }

            .close-button {
                top: 0.5rem; /* Posição do 'X' mais para dentro do padding */
                right: 0.5rem; /* Posição do 'X' mais para dentro do padding */
                font-size: 1.2rem; /* Tamanho menor do 'X' */
                width: 25px; /* Tamanho fixo do botão */
                height: 25px; /* Tamanho fixo do botão */
                line-height: 25px; /* Para centralizar o X */
            }

            /* Testimonial carousel */
            .testimonial-carousel {
                height: 180px;
                padding: 1rem 0;
            }
            .testimonial-card p {
                font-size: clamp(0.9rem, 3.8vw, 1rem);
            }
            .testimonial-card .client-name {
                font-size: clamp(0.8rem, 3.5vw, 0.9rem);
            }

            /* General button adjustments */
            .whatsapp-button, .form-button, .schedule-button, .feedback-button, .testimonial-button {
                font-size: clamp(0.9rem, 3.8vw, 1rem);
                padding: 0.7rem 1.2rem;
                width: 100%;
                margin-bottom: 1rem;
                display: block;
            }
            .puzzle-section .whatsapp-button:last-child,
            .puzzle-section .form-button:last-child,
            .puzzle-section .schedule-button:last-child,
            .puzzle-section .feedback-button:last-child,
            .puzzle-section .testimonial-button:last-child {
                margin-bottom: 0;
            }

            .puzzle-section .whatsapp-button + .form-button,
            .puzzle-section .form-button + .schedule-button,
            .puzzle-section .schedule-button + .feedback-button,
            .puzzle-section .feedback-button + .testimonial-button {
                margin-top: 0;
            }
            .puzzle-section .whatsapp-button.float-effect,
            .puzzle-section .form-button.float-effect,
            .puzzle-section .schedule-button.float-effect,
            .puzzle-section .feedback-button.float-effect,
            .puzzle-section .testimonial-button.float-effect {
                animation: none !important;
            }
        }

        @media (max-width: 480px) {
            /* Further small adjustments for very small screens */
            .brand-name {
                font-size: clamp(1.5rem, 7vw, 1.75rem);
            }

            h2 {
                font-size: clamp(1.8rem, 7vw, 2.25rem);
            }

            h3 {
                font-size: clamp(1.3rem, 5.5vw, 1.6rem);
            }

            p {
                font-size: clamp(0.85rem, 4vw, 1rem);
            }

            .chat-container {
                height: 350px;
                padding: 0.75rem;
            }

            .message {
                max-width: 90%;
                font-size: 0.8rem;
            }

            .chat-input textarea,
            .chat-input button {
                font-size: 0.8rem;
                padding: 0.5rem 0.8rem;
            }

            .modal-content {
                padding: 1rem;
                width: 98%;
            }
            /* Ajuste específico para o modal de agendamento em mobile muito pequeno */
            #scheduleModal .modal-content {
                max-height: calc(100vh - 2rem); /* Mais agressivo para garantir que caiba */
                margin: 1rem auto; /* Reduz margem vertical */
            }
            .modal-content input,
            .modal-content textarea,
            .modal-content .form-button { /* Alvo específico para botões de formulário no modal */
                font-size: 0.85rem;
                padding: 0.5rem;
            }

            .modal-content textarea {
                min-height: 80px;
            }

            .close-button {
                top: 0.5rem; /* Posição do 'X' mais para dentro do padding */
                right: 0.5rem; /* Posição do 'X' mais para dentro do padding */
                font-size: 1.2rem; /* Tamanho menor do 'X' */
                width: 25px; /* Tamanho fixo do botão */
                height: 25px; /* Tamanho fixo do botão */
                line-height: 25px; /* Para centralizar o X */
            }

            .testimonial-carousel {
                height: 150px;
            }
            .testimonial-card p {
                font-size: 0.85rem;
            }
            .testimonial-card .client-name {
                font-size: 0.75rem;
            }
            .whatsapp-button, .form-button, .schedule-button, .feedback-button, .testimonial-button {
                font-size: 0.85rem;
                padding: 0.6rem 1rem;
            }
            /* Adjust puzzle piece sizes for very small screens */
            .puzzle-section::before,
            .puzzle-section::after {
                width: 25px;
                height: 12px;
            }
        }
    </style>
</head>
<body class="text-gray-100">
    <div class="stars-container" id="stars-container"></div>
    <nav class="shadow-lg fixed w-full z-10">
        <div class="flex justify-between h-16 items-center">
            <div class="flex items-center content-layer">
                <img src="https://i.imgur.com/sE44ypp.png" alt="Logo da Asthro" class="h-40 md:h-40" />
            </div>
            <button class="hamburger" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="flex items-center space-x-6 content-layer desktop-nav">
                <a href="https://mateuszito2024.github.io/Cria-o-de-Sites/index.html" class="nav-link text-lg transition">Início</a>
                <a href="https://mateuszito2024.github.io/Cria-o-de-Sites/servi%C3%A7os.html" class="nav-link text-lg transition">Serviços</a>
                <a href="https://mateuszito2024.github.io/Cria-o-de-Sites/sobre.html" class="nav-link text-lg transition">Sobre</a>
                <a href="https://mateuszito2024.github.io/Cria-o-de-Sites/portf%C3%B3lio.html" class="nav-link text-lg transition">Portfólio</a>
                <a href="https://mateuszito2024.github.io/Cria-o-de-Sites/contato.html" class="nav-link text-lg transition">Contato</a>
            </div>
            <div class="nav-menu-mobile content-layer">
                <a href="https://mateuszito2024.github.io/Cria-o-de-Sites/index.html" class="nav-link text-lg transition block">Início</a>
                <a href="https://mateuszito2024.github.io/Cria-o-de-Sites/servi%C3%A7os.html" class="nav-link text-lg transition block">Serviços</a>
                <a href="https://mateuszito2024.github.io/Cria-o-de-Sites/sobre.html" class="nav-link text-lg transition block">Sobre</a>
                <a href="https://mateuszito2024.github.io/Cria-o-de-Sites/portf%C3%B3lio.html" class="nav-link text-lg transition block">Portfólio</a>
                <a href="https://mateuszito2024.github.io/Cria-o-de-Sites/contato.html" class="nav-link text-lg transition block">Contato</a>
            </div>
        </div>
    </nav>
    <main>
        <section class="py-32 relative">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 content-layer">
                <h2 class="text-5xl font-bold animated-gradient-text">
                    Fale com a Asthro
                </h2>
                <p class="text-xl text-gray-200 mt-6 max-w-2xl mx-auto">
                    <span class="puzzle-piece puzzle-piece-left">Tem uma ideia incrível?</span>
                    <span class="puzzle-piece puzzle-piece-right">Quer tirar uma dúvida ou só bater um papo sobre o seu projeto?</span>
                    <span class="puzzle-piece puzzle-piece-top">A gente adora conversar!</span>
                    <span class="puzzle-piece puzzle-piece-bottom">Escolha o melhor canal e fale com a gente.</span>
                </p>
            </div>
        </section>
        <section class="py-20 relative">
            <div class="puzzle-section">
                <h3 class="text-3xl font-bold mb-6 animated-gradient-text">
                    Formulário de Contato
                </h3>
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages"></div>
                    <div class="chat-input" id="chatInput">
                        <textarea id="userInput" placeholder="Digite sua resposta..." rows="1" onkeypress="handleKeyPress(event)"></textarea>
                        <button onclick="sendMessage()">Enviar</button>
                    </div>
                </div>
            </div>
        </section>
        <section class="py-20 relative">
            <div class="puzzle-section">
                <h3 class="text-3xl font-bold mb-6 animated-gradient-text">
                    Atendimento via WhatsApp
                </h3>
                <p class="text-lg text-gray-200 mb-6 max-w-xl mx-auto">
                    <span class="puzzle-piece puzzle-piece-top">Quer uma resposta rápida?</span>
                    <span class="puzzle-piece puzzle-piece-bottom">Chama a gente no WhatsApp!</span>
                </p>
                <a href="https://api.whatsapp.com/send/?phone=5511987637786" target="_blank" class="whatsapp-button float-effect puzzle-piece puzzle-piece-top">
                    Conversar Agora
                </a>
            </div>
        </section>
        <section class="py-20 relative">
            <div class="puzzle-section">
                <h3 class="text-3xl font-bold mb-6 animated-gradient-text">
                    Onde estamos?
                </h3>
                <p class="text-lg text-gray-200 max-w-xl mx-auto">
                    <span class="puzzle-piece puzzle-piece-top">A Asthro é 100% digital, mas nosso</span>
                    <span class="puzzle-piece puzzle-piece-bottom">coração está no Brasil — espalhando criatividade pra todos os cantos.</span>
                </p>
            </div>
        </section>
        <section class="py-20 relative">
            <div class="puzzle-section">
                <h3 class="text-3xl font-bold mb-6 animated-gradient-text">
                    Agende uma reunião
                </h3>
                <p class="text-lg text-gray-200 mb-6 max-w-xl mx-auto">
                    <span class="puzzle-piece puzzle-piece-top">Prefere uma conversa mais detalhada?</span>
                    <span class="puzzle-piece puzzle-piece-bottom">Agende um horário com a gente e vamos trocar uma ideia sobre seu projeto.</span>
                </p>
                <button class="schedule-button float-effect puzzle-piece puzzle-piece-top" onclick="showScheduleModal()">
                    Agendar Reunião
                </button>
                <div class="modal-overlay" id="scheduleModal">
                    <div class="modal-content">
                        <button class="close-button" onclick="hideScheduleModal()">×</button>
                        <h4 class="text-2xl font-bold mb-4 animated-gradient-text">Agende sua Reunião</h4>
                        <div id="scheduleFormContainer">
                            <input type="text" id="scheduleName" placeholder="Seu nome" maxlength="50">
                            <input type="email" id="scheduleEmail" placeholder="Seu e-mail">
                            <input type="date" id="scheduleDate" placeholder="Data preferida">
                            <input type="time" id="scheduleTime" placeholder="Horário preferido">
                            <textarea id="scheduleMessage" placeholder="Mensagem (opcional)" maxlength="500"></textarea>
                            <button class="form-button" onclick="submitSchedule()">Enviar</button>
                            <div id="modalScheduleFeedback"></div> </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="py-20 relative">
            <div class="puzzle-section">
                <h3 class="text-3xl font-bold mb-6 animated-gradient-text">
                    Feedback ou sugestão?
                </h3>
                <p class="text-lg text-gray-200 mb-6 max-w-xl mx-auto">
                    <span class="puzzle-piece puzzle-piece-top">Tem um feedback pra compartilhar ou</span>
                    <span class="puzzle-piece puzzle-piece-bottom">compartilhar uma sugestão, estamos ouvindo! Feedbacks ajudam a gente a melhorar cada vez mais.</span>
                </p>
                <button class="feedback-button float-effect puzzle-piece puzzle-piece-top" onclick="showFeedbackModal()">
                    Enviar Feedback
                </button>
                <div class="modal-overlay" id="feedbackModal">
                    <div class="modal-content">
                        <button class="close-button" onclick="hideFeedbackModal()">×</button>
                        <h4 class="text-2xl font-bold mb-4 animated-gradient-text">Deixe seu Feedback</h4>
                        <div id="feedbackFormContainer">
                            <input type="text" id="feedbackName" placeholder="Seu nome" maxlength="50">
                            <input type="email" id="feedbackEmail" placeholder="Seu e-mail">
                            <textarea id="feedbackText" placeholder="Seu feedback ou sugestão" maxlength="500"></textarea>
                            <button class="form-button" onclick="submitFeedback()">Enviar</button>
                            <div id="modalFeedbackStatus"></div> </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="py-20 relative">
            <div class="puzzle-section">
                <h3 class="text-3xl font-bold mb-6 animated-gradient-text">
                    Depoimentos Rápidos
                </h3>
                <div class="testimonial-carousel">
                    <div class="testimonial-slide active">
                        <div class="testimonial-card puzzle-piece puzzle-piece-top">
                            <p>"Eles captaram minha ideia logo de cara e transformaram em um site que é a cara da minha marca."</p>
                            <p class="client-name mt-2">— Zenor Mariano, Empreendedor</p>
                        </div>
                    </div>
                    <div class="testimonial-slide">
                        <div class="testimonial-card puzzle-piece puzzle-piece-bottom">
                            <p>"A comunicação foi perfeita, e o projeto ficou incrível. Estou muito satisfeito!"</p>
                            <p class="client-name mt-2">— Caio Fellipe, Designer</p>
                        </div>
                    </div>
                </div>
                <button class="testimonial-button float-effect puzzle-piece puzzle-piece-top mt-6" onclick="showTestimonialModal()">
                    Enviar Depoimento
                </button>
                <div class="modal-overlay" id="testimonialModal">
                    <div class="modal-content">
                        <button class="close-button" onclick="hideTestimonialModal()">×</button>
                        <h4 class="text-2xl font-bold mb-4 animated-gradient-text">Envie seu Depoimento</h4>
                        <div id="testimonialFormContainer">
                            <input type="text" id="testimonialName" placeholder="Seu nome" maxlength="50">
                            <input type="text" id="testimonialProfession" placeholder="Sua profissão" maxlength="100">
                            <input type="email" id="testimonialEmail" placeholder="Seu e-mail">
                            <textarea id="testimonialComment" placeholder="Seu depoimento" maxlength="500"></textarea>
                            <button class="form-button" onclick="submitTestimonial()">Enviar</button>
                            <div id="modalTestimonialStatus"></div> </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <footer class="text-gray-200 py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 content-layer">
            <p>© 2025 Asthro. Todos os direitos reservados.</p>
        </div>
    </footer>
    <script>
        // Smooth scroll for nav links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
                // Fecha o menu hambúrguer ao clicar em um link, apenas em telas menores
                if (window.innerWidth <= 768) {
                    toggleMenu();
                }
            });
        });

        // Hamburger menu functionality
        const hamburger = document.querySelector('.hamburger');
        const mobileNavMenu = document.querySelector('.nav-menu-mobile');

        function toggleMenu() {
            hamburger.classList.toggle('active');
            mobileNavMenu.classList.toggle('active');
            document.body.style.overflowY = mobileNavMenu.classList.contains('active') ? 'hidden' : 'auto';
        }

        hamburger.addEventListener('click', toggleMenu);

        // Hide mobile menu on resize if it becomes desktop view
        window.addEventListener('resize', () => {
            if (window.innerWidth > 768 && mobileNavMenu.classList.contains('active')) {
                toggleMenu();
            }
        });

        // Close mobile menu if clicked outside
        document.addEventListener('click', (e) => {
            if (window.innerWidth <= 768 && !hamburger.contains(e.target) && !mobileNavMenu.contains(e.target) && mobileNavMenu.classList.contains('active')) {
                toggleMenu();
            }
        });

        // Puzzle piece animations on scroll
        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.querySelectorAll('.puzzle-piece').forEach((el, index) => {
                        el.style.animationDelay = `${index * 0.2}s`;
                        // Remove classes de saída para que a animação de entrada seja aplicada corretamente
                        el.classList.remove('puzzle-piece-left-exit', 'puzzle-piece-right-exit', 'puzzle-piece-top-exit', 'puzzle-piece-bottom-exit');
                        // Garante que a classe de animação de entrada seja adicionada se não estiver lá
                        if (el.classList.contains('puzzle-piece-left')) {
                            el.classList.add('puzzle-piece-left');
                        } else if (el.classList.contains('puzzle-piece-right')) {
                            el.classList.add('puzzle-piece-right');
                        } else if (el.classList.contains('puzzle-piece-top')) {
                            el.classList.add('puzzle-piece-top');
                        } else if (el.classList.contains('puzzle-piece-bottom')) {
                            el.classList.add('puzzle-piece-bottom');
                        }
                    });
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.3 });

        // Observa todos os elementos com classes de animação de puzzle piece
        document.querySelectorAll('.puzzle-section, .content-layer').forEach(el => observer.observe(el));

        // Animation for h2, h3 titles
        const titleObserver = new IntersectionObserver(entries => {
            entries.forEach((entry) => {
                const title = entry.target;
                // Determine a direção com base na classe existente ou padrão para fade-in
                let animationClass = 'fade-in'; // Padrão
                if (title.classList.contains('slide-in-left')) {
                    animationClass = 'slide-in-left';
                } else if (title.classList.contains('slide-in-right')) {
                    animationClass = 'slide-in-right';
                }

                if (entry.isIntersecting) {
                    title.style.opacity = '1';
                    title.classList.remove('puzzle-piece-left-exit', 'puzzle-piece-right-exit', 'puzzle-piece-top-exit', 'puzzle-piece-bottom-exit'); // Remover todas as classes de saída
                    title.classList.add(animationClass);
                } else {
                    title.classList.remove(animationClass);
                    // Adicionar classes de saída se estiver animando para fora da tela
                    if (animationClass === 'slide-in-left') {
                        title.classList.add('puzzle-piece-left-exit');
                    } else if (animationClass === 'slide-in-right') {
                        title.classList.add('puzzle-piece-right-exit');
                    }
                    title.style.opacity = '0'; // Força a opacidade para 0 quando não visível
                }
            });
        }, { threshold: 0.3 });

        // Observa todos os h2 e h3 com classes de animação
        document.querySelectorAll('h2, h3').forEach((title) => {
            titleObserver.observe(title);
            title.style.opacity = '0'; // Garante que estejam invisíveis inicialmente
        });

        // Stars background initialization (Corrigido para usar window.innerWidth/Height)
        const starsContainer = document.getElementById('stars-container');
        const colors = ['purple', 'pink', 'white'];
        const numStars = 150;

        function createStars() {
            // Limpa estrelas existentes para recriar se a janela for redimensionada
            starsContainer.innerHTML = '';
            // Usa window.innerWidth e window.innerHeight para a viewport atual
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;

            for (let i = 0; i < numStars; i++) {
                const star = document.createElement('span');
                star.classList.add('star');
                star.classList.add(colors[Math.floor(Math.random() * colors.length)]);
                // Posição aleatória dentro da viewport
                star.style.left = `${Math.random() * viewportWidth}px`;
                star.style.top = `${Math.random() * viewportHeight}px`;
                const moveX = (Math.random() - 0.5) * 300;
                const moveY = (Math.random() - 0.5) * 300;
                star.style.setProperty('--move-x', `${moveX}px`);
                star.style.setProperty('--move-y', `${moveY}px`);
                star.style.animationDelay = `${Math.random() * 15}s`;
                starsContainer.appendChild(star);
            }
        }

        // Cria estrelas no carregamento e ao redimensionar (para ajustar a distribuição)
        createStars();
        window.addEventListener('resize', createStars);

        // Carousel logic for testimonials
        const testimonialSlides = document.querySelectorAll('.testimonial-slide');
        let currentTestimonialSlide = 0;
        let testimonialIntervalId;

        function showNextTestimonialSlide() {
            testimonialSlides[currentTestimonialSlide].classList.remove('active');
            currentTestimonialSlide = (currentTestimonialSlide + 1) % testimonialSlides.length;
            testimonialSlides[currentTestimonialSlide].classList.add('active');
        }

        function startTestimonialCarousel() {
            if (testimonialIntervalId) clearInterval(testimonialIntervalId);
            testimonialIntervalId = setInterval(showNextTestimonialSlide, 5000);
        }

        function stopTestimonialCarousel() {
            clearInterval(testimonialIntervalId);
        }

        // Inicia o carrossel de depoimentos no carregamento
        if (testimonialSlides.length > 0) {
            startTestimonialCarousel();
            // Adiciona eventos de mouse para pausar/retomar o carrossel de depoimentos
            const testimonialCarouselContainer = document.querySelector('.testimonial-carousel');
            if (testimonialCarouselContainer) {
                testimonialCarouselContainer.addEventListener('mouseenter', stopTestimonialCarousel);
                testimonialCarouselContainer.addEventListener('mouseleave', startTestimonialCarousel);
            }
        }


        // Chatbot logic (ajustado para melhor comportamento em mobile)
        let chatMessages = document.getElementById('chatMessages');
        let userInput = document.getElementById('userInput');
        let chatState = {
            step: 1,
            name: '',
            email: '',
            whatsapp: '',
            message: ''
        };
        let isBotTyping = false;
        let hasGreeted = false;
        let isCorrecting = false;
        let fieldToCorrect = null;

        const commonGreetings = [
            'oi', 'olá', 'ola', 'bom dia', 'boa tarde', 'boa noite',
            'tudo bem', 'tudo bom', 'como vai', 'e aí', 'e ai', 'eai',
            'oiê', 'oie', 'oiee', 'oláá', 'olaa', 'oláa', 'tô de boa',
            'tô bem', 'tô de boa?', 'tô bem?', 'como você está',
            'como você ta', 'como você tá', 'e você', 'e tu', 'e voce',
            'opa'
        ];

        const botGreetings = [
            'Que bom te ver! 😊',
            'Seja bem-vindo! 😊',
            'É um prazer te conhecer! 😊',
            'Fico feliz em te ajudar hoje! 😊'
        ];

        const correctionKeywords = [
            'errei', 'ops', 'opa', 'eita', 'está errado', 'esta errado',
            'está errada', 'esta errada', 'corrigir', 'alterar', 'trocar',
            'tá errado', 'errado', 'não', 'não sou eu', 'meu nome não é esse',
            'isso está errado', 'o meu nome está errado', 'você escreveu errado',
            'meu nome está digitado errado', 'o nome está errado', 'digitei errado',
            'opa o nome tá errado'
        ];

        const fieldKeywords = {
            name: ['nome', 'meu nome'],
            email: ['email', 'e-mail', 'mail'],
            whatsapp: ['whatsapp', 'whats', 'telefone', 'número', 'numero']
        };

        function isGreeting(message) {
            const normalizedMessage = message.toLowerCase().trim();
            return commonGreetings.some(greeting => 
                normalizedMessage === greeting || 
                normalizedMessage.startsWith(greeting + ' ') || 
                normalizedMessage.endsWith(' ' + greeting) ||
                normalizedMessage.includes(' ' + greeting + ' ')
            );
        }

        function isValidName(name) {
            const normalizedName = name.trim();
            const nameRegex = /^[a-zA-ZÀ-ÿ\s-]+$/;
            return (
                nameRegex.test(normalizedName) &&
                normalizedName.length <= 50 &&
                !normalizedName.includes(',') &&
                !normalizedName.includes('?') &&
                !normalizedName.includes('!')
            );
        }
        
        function extractName(message) {
            let name = message.trim();
            const phrasesToRemove = [
                'meu nome é', 'meu nome e', 'sou', 'sou a', 'sou o',
                'chamo-me', 'me chamo', 'é', 'e', 'oi', 'olá', 'ola',
                'bom dia', 'boa tarde', 'boa noite', 'tudo bem', 'tudo bom',
                'como vai', 'e aí', 'e ai', 'eai', 'oiê', 'oie', 'oiee',
                'oláá', 'olaa', 'oláa', 'tô de boa',
                'tô bem', 'tô de boa?', 'tô bem?', 'como você está',
                'como você ta', 'como você tá', 'e você', 'e tu', 'e voce'
            ];
            phrasesToRemove.forEach(phrase => {
                const regex = new RegExp(`\\b${phrase}\\b`, 'gi');
                name = name.replace(regex, '').trim();
            });
            name = name.replace(/[.,!?]/g, '').trim();
            name = name.replace(/\b\w/g, char => char.toUpperCase());
            const words = name.split(/\s+/);
            if (words.length > 1) {
                name = words[words.length - 1];
            }
            return name;
        }

        function selectBotGreeting(userGreeting) {
            const normalizedUserGreeting = userGreeting.toLowerCase().trim();
            let availableGreetings = botGreetings;
            const userGreetingWords = normalizedUserGreeting.split(' ');
            availableGreetings = botGreetings.filter(greeting => {
                const greetingWords = greeting.toLowerCase().split(' ');
                return !userGreetingWords.some(word => greetingWords.includes(word));
            });
            if (availableGreetings.length === 0) {
                availableGreetings = botGreetings;
            }
            return availableGreetings[Math.floor(Math.random() * availableGreetings.length)];
        }

        function detectCorrectionRequest(message) {
            const normalizedMessage = message.toLowerCase().trim();
            const isCorrection = correctionKeywords.some(keyword => 
                normalizedMessage.includes(keyword)
            );
            if (!isCorrection) return null;
            if (fieldKeywords.name.some(keyword => normalizedMessage.includes(keyword)) || chatState.step === 2) {
                return 'name';
            }
            for (const [field, keywords] of Object.entries(fieldKeywords)) {
                if (keywords.some(keyword => normalizedMessage.includes(keyword))) {
                    return field;
                }
            }
            if (chatState.step === 2) {
                return 'name';
            }
            return null;
        }

        function askForCorrectedData(field) {
            let question;
            switch (field) {
                case 'name':
                    question = "Qual seria o nome correto?";
                    break;
                case 'email':
                    question = "Qual seria o e-mail correto?";
                    break;
                case 'whatsapp':
                    question = "Qual seria o número de WhatsApp correto?";
                    break;
                default:
                    question = "Desculpe, não entendi qual dado você quer corrigir. Pode especificar?";
            }
            showTypingIndicator();
            setTimeout(() => {
                removeTypingIndicator();
                addBotMessage(question);
            }, 2000);
        }

        function continueFlow() {
            showTypingIndicator();
            setTimeout(() => {
                removeTypingIndicator();
                if (chatState.step === 1) {
                    addBotMessage("Olá! Sou o assistente da Asthro. 😊 Qual é o seu nome ou como você gostaria de ser chamado?");
                } else if (chatState.step === 2) {
                    addBotMessage(`Prazer em conhecê-lo, ${chatState.name}! Qual é o seu e-mail de contato?`);
                } else if (chatState.step === 3) {
                    addBotMessage("Ótimo! Qual é o seu número de WhatsApp?");
                } else if (chatState.step === 4) {
                    addBotMessage("Perfeito! Agora, qual é a mensagem que você gostaria de enviar?");
                    userInput.placeholder = "Digite sua mensagem...";
                    userInput.rows = 3;
                }
                saveChatState();
            }, 2000);
        }

        // Initialize chat state on page load (reset chat)
        window.onload = function() {
            localStorage.removeItem('chatState');
            chatState = {
                step: 1,
                name: '',
                email: '',
                whatsapp: '',
                message: ''
            };
            hasGreeted = false;
            // Re-initialize chat elements if they exist
            if (chatMessages && userInput) { 
                const chatContainer = document.querySelector('.chat-container');
                if (chatContainer) {
                    chatContainer.classList.remove('success'); 
                    chatMessages.innerHTML = ''; 
                    userInput.value = '';
                    userInput.placeholder = "Digite sua resposta...";
                    userInput.rows = 1;
                }
            }
            // Re-observe contact section
            const contactSection = document.querySelector('section:nth-of-type(2)');
            if (contactSection) {
                contactSectionObserver.observe(contactSection);
            }
            createStars();
        };

        function loadChatState() {
            const savedState = localStorage.getItem('chatState');
            if (savedState) {
                chatState = JSON.parse(savedState);
                restoreChat();
            }
        }

        function saveChatState() {
            localStorage.setItem('chatState', JSON.stringify(chatState));
        }

        function restoreChat() {
            chatMessages.innerHTML = '';
            if (chatState.step >= 1) {
                addBotMessage("Olá! Sou o assistente da Asthro. 😊 Qual é o seu nome ou como você gostaria de ser chamado?");
                if (chatState.name) {
                    addUserMessage(chatState.name);
                }
            }
            if (chatState.step >= 2) {
                addBotMessage(`Prazer em conhecê-lo, ${chatState.name}! Qual é o seu e-mail de contato?`);
                if (chatState.email) {
                    addUserMessage(chatState.email);
                }
            }
            if (chatState.step >= 3) {
                addBotMessage("Ótimo! Qual é o seu número de WhatsApp?");
                if (chatState.whatsapp) {
                    addUserMessage(chatState.whatsapp);
                }
            }
            if (chatState.step >= 4) {
                addBotMessage("Perfeito! Agora, qual é a mensagem que você gostaria de enviar?");
                if (chatState.message) {
                    addUserMessage(chatState.message);
                }
            }
            if (chatState.step === 5) {
                showSuccessMessage();
            }
            scrollToBottom();
        }

        function addBotMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', 'bot-message');
            messageElement.textContent = message;
            chatMessages.appendChild(messageElement);
            scrollToBottom();
        }

        function addUserMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', 'user-message');
            messageElement.textContent = message;
            chatMessages.appendChild(messageElement);
            scrollToBottom();
        }

        function showTypingIndicator() {
            const typingElement = document.createElement('div');
            typingElement.classList.add('typing-indicator');
            typingElement.innerHTML = '<span></span><span></span><span></span>';
            typingElement.id = 'typingIndicator';
            chatMessages.appendChild(typingElement);
            scrollToBottom();
            isBotTyping = true;
        }

        function removeTypingIndicator() {
            const typingElement = document.getElementById('typingIndicator');
            if (typingElement) {
                typingElement.remove();
            }
            isBotTyping = false;
        }

        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function isValidPhoneNumber(phone) {
            const phoneRegex = /^\+?[\d\s()-]{7,}$/;
            return phoneRegex.test(phone);
        }

        function isValidDate(dateStr) {
            const inputDate = new Date(dateStr);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            return inputDate >= today && !isNaN(inputDate);
        }

        const contactSectionObserver = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting && !hasGreeted && chatState.step === 1 && !chatState.name) {
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Olá! Sou o assistente da Asthro. 😊 Qual é o seu nome ou como você gostaria de ser chamado?");
                        hasGreeted = true;
                        saveChatState();
                    }, 3000);
                }
            });
        }, { threshold: 0.3 });

        function sendMessage() {
            if (isBotTyping) return;
            const userText = userInput.value.trim();
            if (!userText) return;

            addUserMessage(userText);

            const correctionField = detectCorrectionRequest(userText);
            if (correctionField && chatState.step < 5) {
                fieldToCorrect = correctionField;
                isCorrecting = true;
                askForCorrectedData(correctionField);
                userInput.value = '';
                return;
            }

            if (isCorrecting) {
                let isValid = true;
                let errorMessage = '';
                if (fieldToCorrect === 'name') {
                    if (isValidName(userText)) {
                        chatState.name = userText;
                    } else {
                        isValid = false;
                        errorMessage = "Desculpe, não sei se esse é o seu nome. 😅 Pode me dizer um nome válido?";
                    }
                } else if (fieldToCorrect === 'email') {
                    if (isValidEmail(userText)) {
                        chatState.email = userText;
                    } else {
                        isValid = false;
                        errorMessage = "Desculpe, isso não parece ser um e-mail válido. Por favor, insira um e-mail válido (exemplo: seuemail@dominio.com).";
                    }
                } else if (fieldToCorrect === 'whatsapp') {
                    if (isValidPhoneNumber(userText)) {
                        chatState.whatsapp = userText;
                    } else {
                        isValid = false;
                        errorMessage = "Desculpe, isso não parece ser um número de telefone válido. Por favor, insira um número de WhatsApp válido (exemplo: +5511999999999).";
                    }
                }

                if (isValid) {
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Dado corrigido com sucesso! 😊");
                        isCorrecting = false;
                        fieldToCorrect = null;
                        continueFlow();
                    }, 2000);
                } else {
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage(errorMessage);
                    }, 2000);
                }
                userInput.value = '';
                saveChatState();
                return;
            }

            if (chatState.step === 1) {
                if (isGreeting(userText)) {
                    const botGreeting = selectBotGreeting(userText);
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage(`${botGreeting} Qual é o seu nome ou como você gostaria de ser chamado?`);
                    }, 3000);
                } else if (isValidName(userText)) {
                    chatState.name = userText;
                    chatState.step = 2;
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage(`Prazer em conhecê-lo, ${chatState.name}! Qual é o seu e-mail de contato?`);
                        saveChatState();
                    }, 3000);
                } else {
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Desculpe, não sei se esse é o seu nome. 😅 Pode me dizer seu nome ou como você gostaria de ser chamado?");
                    }, 3000);
                }
            } else if (chatState.step === 2) {
                if (isValidEmail(userText)) {
                    chatState.email = userText;
                    chatState.step = 3;
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Ótimo! Qual é o seu número de WhatsApp?");
                        saveChatState();
                    }, 3000);
                } else {
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Desculpe, isso não parece ser um e-mail válido. Por favor, insira um e-mail válido (exemplo: seuemail@dominio.com).");
                    }, 3000);
                }
            } else if (chatState.step === 3) {
                if (isValidPhoneNumber(userText)) {
                    chatState.whatsapp = userText;
                    chatState.step = 4;
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Perfeito! Agora, qual é a mensagem que você gostaria de enviar?");
                        userInput.placeholder = "Digite sua mensagem...";
                        userInput.rows = 3;
                        saveChatState();
                    }, 3000);
                } else {
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Desculpe, isso não parece ser um número de telefone válido. Por favor, insira um número de WhatsApp válido (exemplo: +5511999999999).");
                    }, 3000);
                }
            } else if (chatState.step === 4) {
                chatState.message = userText;
                chatState.step = 5;
                sendToFormspree();
            }
            userInput.value = '';
            saveChatState();
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function sendToFormspree() {
            const formData = new FormData();
            formData.append('name', chatState.name);
            formData.append('email', chatState.email);
            formData.append('whatsapp', chatState.whatsapp);
            formData.append('message', chatState.message);
            fetch('https://formspree.io/f/mgvolbyv', {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            })
            .then(response => {
                if (response.ok) {
                    showSuccessMessage();
                } else {
                    addBotMessage("Desculpe, houve um erro ao enviar sua mensagem. Tente novamente mais tarde.");
                }
            })
            .catch(error => {
                addBotMessage("Desculpe, houve um erro ao enviar sua mensagem. Tente novamente mais tarde.");
            });
        }

        function showSuccessMessage() {
            const section = document.querySelector('section:nth-of-type(2)');
            const puzzleSection = section.querySelector('.puzzle-section');
            if (puzzleSection) {
                puzzleSection.remove();
            }
            
            const successContainer = document.createElement('div');
            successContainer.classList.add('success-message-container');
            const successMessage = document.createElement('div');
            successMessage.classList.add('sparkle-text');
            successMessage.textContent = 'Mensagem Enviada! ✨';
            successContainer.appendChild(successMessage);
            section.appendChild(successContainer);
            localStorage.removeItem('chatState');
            chatState = {
                step: 1,
                name: '',
                email: '',
                whatsapp: '',
                message: ''
            };
        }

        // Modal functions (Schedule, Feedback, Testimonial)
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('show');
                document.body.style.overflow = 'hidden'; // Evita rolagem do body quando modal está aberto
            }
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('show');
                document.body.style.overflow = 'auto'; // Restaura rolagem do body
            }
        }

        function showScheduleModal() {
            showModal('scheduleModal');
            document.getElementById('scheduleName').value = '';
            document.getElementById('scheduleEmail').value = '';
            document.getElementById('scheduleDate').value = '';
            document.getElementById('scheduleTime').value = '';
            document.getElementById('scheduleMessage').value = '';
            // Limpa a mensagem de feedback do modal de agendamento
            const modalScheduleFeedbackElement = document.getElementById('modalScheduleFeedback');
            if (modalScheduleFeedbackElement) {
                modalScheduleFeedbackElement.innerHTML = '';
            }
            const dateInput = document.getElementById('scheduleDate');
            const today = new Date().toISOString().split('T')[0];
            dateInput.setAttribute('min', today);
        }

        function hideScheduleModal() {
            hideModal('scheduleModal');
        }

        function submitSchedule() {
            const name = document.getElementById('scheduleName').value.trim();
            const email = document.getElementById('scheduleEmail').value.trim();
            const date = document.getElementById('scheduleDate').value;
            const time = document.getElementById('scheduleTime').value;
            const message = document.getElementById('scheduleMessage').value.trim();
            
            // Certifique-se de que o elemento de mensagem de feedback existe no modal
            let modalScheduleMessage = document.getElementById('modalScheduleFeedback');
            if (!modalScheduleMessage) {
                modalScheduleMessage = document.createElement('div');
                modalScheduleMessage.id = 'modalScheduleFeedback';
                document.getElementById('scheduleFormContainer').appendChild(modalScheduleMessage);
            }
            modalScheduleMessage.innerHTML = '';

            if (!name || !isValidName(name)) {
                modalScheduleMessage.innerHTML = '<div class="error-message">Por favor, insira um nome válido (apenas letras e espaços, até 50 caracteres).</div>';
                return;
            }
            if (!email || !isValidEmail(email)) {
                modalScheduleMessage.innerHTML = '<div class="error-message">Por favor, insira um e-mail válido.</div>';
                return;
            }
            if (!date || !isValidDate(date)) {
                modalScheduleMessage.innerHTML = '<div class="error-message">Por favor, selecione uma data válida (a partir de hoje).</div>';
                return;
            }
            if (!time) {
                modalScheduleMessage.innerHTML = '<div class="error-message">Por favor, selecione um horário.</div>';
                return;
            }
            if (message && message.length > 500) {
                modalScheduleMessage.innerHTML = '<div class="error-message">A mensagem não pode exceder 500 caracteres.</div>';
                return;
            }

            const formData = new FormData();
            formData.append('name', name);
            formData.append('email', email);
            formData.append('date', date);
            formData.append('time', time);
            if (message) { formData.append('message', message); }

            fetch('https://formspree.io/f/mgvolbyv', {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            })
            .then(response => {
                if (response.ok) {
                    modalScheduleMessage.innerHTML = '<div class="success-message">Reunião agendada com sucesso! ✨</div>';
                    document.getElementById('scheduleName').value = '';
                    document.getElementById('scheduleEmail').value = '';
                    document.getElementById('scheduleDate').value = '';
                    document.getElementById('scheduleTime').value = '';
                    document.getElementById('scheduleMessage').value = '';
                    setTimeout(() => hideScheduleModal(), 2000);
                } else {
                    modalScheduleMessage.innerHTML = '<div class="error-message">Erro ao agendar a reunião. Tente novamente.</div>';
                }
            })
            .catch(error => {
                modalScheduleMessage.innerHTML = '<div class="error-message">Erro ao agendar a reunião. Tente novamente.</div>';
            });
        }

        function showFeedbackModal() {
            showModal('feedbackModal');
            document.getElementById('feedbackName').value = '';
            document.getElementById('feedbackEmail').value = '';
            document.getElementById('feedbackText').value = '';
            // Limpa a mensagem de feedback do modal de feedback
            const modalFeedbackStatusElement = document.getElementById('modalFeedbackStatus');
            if (modalFeedbackStatusElement) {
                modalFeedbackStatusElement.innerHTML = '';
            }
        }

        function hideFeedbackModal() {
            hideModal('feedbackModal');
        }

        function submitFeedback() {
            const name = document.getElementById('feedbackName').value.trim();
            const email = document.getElementById('feedbackEmail').value.trim();
            const feedback = document.getElementById('feedbackText').value.trim();
            
            // Certifique-se de que o elemento de mensagem de feedback existe no modal
            let modalFeedbackMessage = document.getElementById('modalFeedbackStatus');
            if (!modalFeedbackMessage) {
                modalFeedbackMessage = document.createElement('div');
                modalFeedbackMessage.id = 'modalFeedbackStatus';
                document.getElementById('feedbackFormContainer').appendChild(modalFeedbackMessage);
            }
            modalFeedbackMessage.innerHTML = '';

            if (!name || !isValidName(name)) {
                modalFeedbackMessage.innerHTML = '<div class="error-message">Por favor, insira um nome válido (apenas letras e espaços, até 50 caracteres).</div>';
                return;
            }
            if (!email || !isValidEmail(email)) {
                modalFeedbackMessage.innerHTML = '<div class="error-message">Por favor, insira um e-mail válido.</div>';
                return;
            }
            if (!feedback || feedback.length > 500) {
                modalFeedbackMessage.innerHTML = '<div class="error-message">Por favor, insira um feedback válido (até 500 caracteres).</div>';
                return;
            }

            const formData = new FormData();
            formData.append('name', name);
            formData.append('email', email);
            formData.append('feedback', feedback);

            fetch('https://formspree.io/f/mgvolbyv', {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            })
            .then(response => {
                if (response.ok) {
                    modalFeedbackMessage.innerHTML = '<div class="success-message">Feedback enviado com sucesso! ✨</div>';
                    document.getElementById('feedbackName').value = '';
                    document.getElementById('feedbackEmail').value = '';
                    document.getElementById('feedbackText').value = '';
                    setTimeout(() => hideFeedbackModal(), 2000);
                } else {
                    modalFeedbackMessage.innerHTML = '<div class="error-message">Erro ao enviar o feedback. Tente novamente.</div>';
                }
            })
            .catch(error => {
                modalFeedbackMessage.innerHTML = '<div class="error-message">Erro ao enviar o feedback. Tente novamente.</div>';
            });
        }

        function showTestimonialModal() {
            showModal('testimonialModal');
            document.getElementById('testimonialName').value = '';
            document.getElementById('testimonialProfession').value = '';
            document.getElementById('testimonialEmail').value = '';
            document.getElementById('testimonialComment').value = '';
            // Limpa a mensagem de feedback do modal de depoimento
            let modalTestimonialStatusElement = document.getElementById('modalTestimonialStatus');
            if (modalTestimonialStatusElement) {
                modalTestimonialStatusElement.innerHTML = '';
            }
        }

        function hideTestimonialModal() {
            hideModal('testimonialModal');
        }

        function submitTestimonial() {
            const name = document.getElementById('testimonialName').value.trim();
            const profession = document.getElementById('testimonialProfession').value.trim();
            const email = document.getElementById('testimonialEmail').value.trim();
            const comment = document.getElementById('testimonialComment').value.trim();
            
            // Certifique-se de que o elemento de mensagem de feedback existe no modal
            let modalTestimonialMessage = document.getElementById('modalTestimonialStatus');
            if (!modalTestimonialMessage) {
                modalTestimonialMessage = document.createElement('div');
                modalTestimonialMessage.id = 'modalTestimonialStatus';
                document.getElementById('testimonialFormContainer').appendChild(modalTestimonialMessage);
            }
            modalTestimonialMessage.innerHTML = '';

            if (!name || !isValidName(name)) {
                modalTestimonialMessage.innerHTML = '<div class="error-message">Por favor, insira um nome válido (apenas letras e espaços, até 50 caracteres).</div>';
                return;
            }
            if (!profession || profession.length > 100) {
                modalTestimonialMessage.innerHTML = '<div class="error-message">Por favor, insira uma profissão válida (até 100 caracteres).</div>';
                return;
            }
            if (!email || !isValidEmail(email)) {
                modalTestimonialMessage.innerHTML = '<div class="error-message">Por favor, insira um e-mail válido.</div>';
                return;
            }
            if (!comment || comment.length > 500) {
                modalTestimonialMessage.innerHTML = '<div class="error-message">Por favor, insira um depoimento válido (até 500 caracteres).</div>';
                return;
            }

            const formData = new FormData();
            formData.append('name', name);
            formData.append('profession', profession);
            formData.append('email', email);
            formData.append('comment', comment);

            fetch('https://formspree.io/f/mgvolbyv', {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            })
            .then(response => {
                if (response.ok) {
                    modalTestimonialMessage.innerHTML = '<div class="success-message">Depoimento enviado com sucesso! ✨</div>';
                    document.getElementById('testimonialName').value = '';
                    document.getElementById('testimonialProfession').value = '';
                    document.getElementById('testimonialEmail').value = '';
                    document.getElementById('testimonialComment').value = '';
                    setTimeout(() => hideTestimonialModal(), 2000);
                } else {
                    modalTestimonialMessage.innerHTML = '<div class="error-message">Erro ao enviar o depoimento. Tente novamente.</div>';
                }
            })
            .catch(error => {
                modalTestimonialMessage.innerHTML = '<div class="error-message">Erro ao enviar o depoimento. Tente novamente.</div>';
            });
        }
        
        // Load chat state and observe contact section
        // Executar após o DOM estar completamente carregado
        document.addEventListener('DOMContentLoaded', () => {
            // Inicializa chat e observa a seção de contato
            loadChatState(); 
            const contactSection = document.querySelector('section:nth-of-type(2)');
            if (contactSection) {
                contactSectionObserver.observe(contactSection);
            }
        });
    </script>
</body>
</html>
