<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Good Vibes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@400;600&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            position: relative;
            overflow-x: hidden;
            background: transparent;
        }

        /* Header Styles */
        .brand-name {
            font-family: 'Great Vibes', cursive;
            line-height: 2;
            padding: 1rem;
            display: block;
            overflow: visible;
        }

        .flex.items-center.content-layer {
            overflow: visible;
        }

        .nav-link {
            font-family: 'Montserrat', sans-serif;
            position: relative;
            text-decoration: none;
            color: #f8f8f8;
            transition: color 0.3s ease;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -4px;
            left: 0;
            background: linear-gradient(135deg, #a5b4fc, #e879f9);
            transition: width 0.3s ease;
        }

        .nav-link:hover::after {
            width: 100%;
        }

        .nav-link:hover {
            color: #e879f9;
        }

        .gradient-text {
            background: linear-gradient(135deg, #a5b4fc, #e879f9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        nav {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 10;
            background: transparent;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 0 1rem;
        }

        nav > div {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        nav .flex.items-center.content-layer:first-child {
            margin-right: auto;
        }

        nav .flex.items-center.content-layer:last-child {
            margin-left: auto;
        }

        nav, section, footer {
            position: relative;
            z-index: 1;
            pointer-events: none;
        }

        nav *, section *, footer * {
            pointer-events: auto;
        }

        .content-layer {
            position: relative;
            z-index: 2;
        }

        h1, h2, h3, p, a, input, textarea, button, img, svg {
            position: relative;
            z-index: 30;
            opacity: 1 !important;
        }

        /* Remaining Styles */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-50px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideOut {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(50px); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        @keyframes stretch {
            0% { transform: scaleY(1); }
            50% { transform: scaleY(1.1); }
            100% { transform: scaleY(1); }
        }

        .fade-in {
            opacity: 1 !important;
            animation: fadeInUp 1s ease-out forwards;
        }

        .section-animate {
            opacity: 1 !important;
        }

        .section-animate.visible {
            animation: slideIn 0.8s ease-out forwards;
        }

        .section-animate:not(.visible) {
            animation: slideOut 0.8s ease-out forwards;
        }

        .service-item, .portfolio-item {
            animation: pulse 3s infinite ease-in-out;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            z-index: 30;
            background: #4b5563;
            border: 3px solid #a5b4fc;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            opacity: 1 !important;
        }

        .service-item:hover, .portfolio-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(168, 85, 247, 0.5);
            background: linear-gradient(135deg, #374151, #4b5563);
            animation: stretch 0.6s ease-in-out, pulse 3s infinite ease-in-out;
        }

        .portfolio-item .overlay {
            transition: opacity 0.3s ease, background 0.3s ease;
            z-index: 30;
            opacity: 0;
        }

        .portfolio-item:hover .overlay {
            opacity: 1;
            background: linear-gradient(135deg, rgba(165, 180, 252, 0.3), rgba(232, 121, 249, 0.3));
        }

        .gradient-bg {
            background: transparent;
        }

        .section-bg {
            background: rgba(31, 41, 55, 0.8);
        }

        #particles-js {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: #1e293b;
        }

        .service-icon {
            fill: url(#gradient);
            width: 48px;
            height: 48px;
            margin-bottom: 1rem;
        }

        /* Estilos para o card de inatividade */
        .inactivity-card {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #374151;
            background-image: url('https://img.lovepik.com/free-png/20211126/lovepik-computer-and-mobile-phone-png-image_401144716_wh1200.png');
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            text-align: center;
            max-width: 500px;
            width: 90%;
        }

        .inactivity-card h3 {
            font-size: 1.5rem;
            font-weight: bold;
            color: #e879f9;
            margin-bottom: 1rem;
        }

        .inactivity-card p {
            color: #a5b4fc;
            margin-bottom: 1.5rem;
            background: rgba(55, 65, 81, 0.7);
            padding: 0.5rem;
            border-radius: 0.5rem;
        }

        .inactivity-card button {
            background: #e879f9;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .inactivity-card button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(232, 121, 249, 0.5);
        }

        .inactivity-card .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: #a5b4fc;
            font-size: 1.5rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            border-radius: 50%;
            transition: color 0.3s ease, background 0.3s ease;
            padding: 0;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .inactivity-card .close-btn:hover {
            color: #e879f9;
            background: rgba(255, 255, 255, 0.1);
        }

        /* Estilos para o chat */
        .chat-container {
            max-width: 600px;
            margin: 0 auto;
            background: #374151;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            height: 500px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .chat-container.success {
            background: transparent;
            padding: 0;
            border-radius: 0;
            box-shadow: none;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            max-width: 70%;
            padding: 0.75rem;
            border-radius: 0.75rem;
            line-height: 1.5;
        }

        .bot-message {
            background: #4b5563;
            color: #e2e8f0;
            align-self: flex-start;
            border-bottom-left-radius: 0;
        }

        .user-message {
            background: #a5b4fc;
            color: #1f2937;
            align-self: flex-end;
            border-bottom-right-radius: 0;
        }

        .typing-indicator {
            display: flex;
            gap: 0.3rem;
            align-self: flex-start;
            padding: 0.75rem;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: #a5b4fc;
            border-radius: 50%;
            animation: bounce 0.6s infinite alternate;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-5px); }
        }

        .chat-input {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #4b5563;
        }

        .chat-input textarea {
            flex: 1;
            padding: 0.75rem;
            background: #4b5563;
            color: #e2e8f0;
            border: 1px solid #a5b4fc;
            border-radius: 0.5rem;
            outline: none;
            resize: none;
            font-family: 'Poppins', sans-serif;
        }

        .chat-input .input-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .chat-input .file-upload {
            display: none; /* Oculta por padrão */
            align-items: center;
        }

        .chat-input .file-upload.visible {
            display: flex; /* Exibe quando necessário */
        }

        .chat-input label {
            display: flex;
            align-items: center;
            background: #4b5563;
            color: #e2e8f0;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chat-input label:hover {
            background: #6b7280;
            transform: translateY(-2px);
        }

        .chat-input button {
            background: #e879f9;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .chat-input button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(232, 121, 249, 0.5);
        }

        /* Estilo para o texto cintilante */
        .sparkle-text {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            color: #e2e8f0;
            background: linear-gradient(90deg, #a5b4fc, #e879f9, #a5b4fc);
            background-size: 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: sparkle 2s infinite, fadeIn 0.5s ease-in-out;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
        }

        @keyframes sparkle {
            0% { background-position: 0%; }
            50% { background-position: 200%; }
            100% { background-position: 0%; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body class="text-gray-100">
    <!-- Interactive Background -->
    <div id="particles-js"></div>

    <!-- SVG Gradient for Icons -->
    <svg width="0" height="0">
        <defs>
            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#a5b4fc;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#e879f9;stop-opacity:1" />
            </linearGradient>
        </defs>
    </svg>

    <!-- Navbar -->
    <nav class="shadow-lg fixed w-full z-10">
        <div class="flex justify-between h-16">
            <div class="flex items-center content-layer">
                <h1 class="text-4xl brand-name gradient-text">Good Vibes</h1>
            </div>
            <div class="flex items-center space-x-6 content-layer">
                <a href="#home" class="nav-link text-lg transition">Início</a>
                <a href="#services" class="nav-link text-lg transition">Serviços</a>
                <a href="about.html" class="nav-link text-lg transition">Sobre</a>
                <a href="portfolio.html" class="nav-link text-lg transition">Portfólio</a>
                <a href="contact.html" class="nav-link text-lg transition">Contato</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="min-h-screen flex items-center gradient-bg section-animate">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center fade-in content-layer">
            <h2 class="text-5xl md:text-7xl font-bold gradient-text">Eleve Sua Marca</h2>
            <p class="mt-4 text-xl md:text-2xl text-gray-200">Soluções digitais com criatividade e impacto.</p>
            <a href="#contact" class="mt-6 inline-block bg-indigo-500 text-white font-semibold py-3 px-8 rounded-full service-item transition">Comece Agora</a>
        </div>
    </section>

    <!-- Services Section -->
    <section id="services" class="py-20 section-bg section-animate">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 content-layer">
            <h2 class="text-4xl font-bold text-center gradient-text mb-12">Nossos Serviços</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="service-item p-6 rounded-xl transition fade-in text-center">
                    <img src="https://i.postimg.cc/wjGtqTVm/pngegg-1.png" alt="Ícone Marketing Digital" class="service-icon mx-auto">
                    <h3 class="text-2xl font-semibold gradient-text mb-4">Marketing Digital</h3>
                    <p class="text-gray-300">Campanhas estratégicas para engajar e converter seu público-alvo.</p>
                </div>
                <div class="service-item p-6 rounded-xl transition fade-in text-center" style="animation-delay: 0.2s;">
                    <img src="https://i.postimg.cc/YqgkG2MF/pngegg-2.png" alt="Ícone Desenvolvimento Web" class="service-icon mx-auto">
                    <h3 class="text-2xl font-semibold gradient-text mb-4">Desenvolvimento Web</h3>
                    <p class="text-gray-300">Sites dinâmicos e responsivos que refletem sua marca.</p>
                </div>
                <div class="service-item p-6 rounded-xl transition fade-in text-center" style="animation-delay: 0.4s;">
                    <img src="https://i.postimg.cc/63Gbj3HL/pngegg-3.png" alt="Ícone Design Gráfico" class="service-icon mx-auto">
                    <h3 class="text-2xl font-semibold gradient-text mb-4">Design Gráfico</h3>
                    <p class="text-gray-300">Visuais únicos que contam a história da sua marca.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="py-20 section-bg section-animate">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center content-layer">
            <h2 class="text-4xl font-bold gradient-text mb-8">Quem Somos</h2>
            <p class="text-xl text-gray-300 max-w-3xl mx-auto fade-in">Na Good Vibes, transformamos visões em realidade com criatividade e inovação. Nossa equipe é apaixonada por criar experiências digitais que inspiram.</p>
        </div>
    </section>

    <!-- Portfolio Section -->
    <section id="portfolio" class="py-20 section-bg section-animate">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 content-layer">
            <h2 class="text-4xl font-bold text-center gradient-text mb-12">Portfólio</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="portfolio-item relative overflow-hidden rounded-xl transition fade-in">
                    <img src="https://i.postimg.cc/kGd1LsST/Prancheta-18.png" alt="Projeto 1 - Flow Digital" class="w-full h-64 object-cover">
                    <div class="overlay absolute inset-0 flex items-center justify-center">
                        <p class="text-white font-bold text-xl">Projeto 1</p>
                    </div>
                </div>
                <div class="portfolio-item relative overflow-hidden rounded-xl transition fade-in" style="animation-delay: 0.2s;">
                    <img src="https://i.postimg.cc/D0ZJfk10/Prancheta-7.png" alt="Projeto 2 - Dra Mari Alves" class="w-full h-64 object-cover">
                    <div class="overlay absolute inset-0 flex items-center justify-center">
                        <p class="text-white font-bold text-xl">Projeto 2</p>
                    </div>
                </div>
                <div class="portfolio-item relative overflow-hidden rounded-xl transition fade-in" style="animation-delay: 0.4s;">
                    <img src="https://i.postimg.cc/fLHyr21N/Prancheta-1.png" alt="Projeto 3 - Viraliza Tráfego" class="w-full h-64 object-cover">
                    <div class="overlay absolute inset-0 flex items-center justify-center">
                        <p class="text-white font-bold text-xl">Projeto 3</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section (Transformed into Chat) -->
    <section id="contact" class="py-20 gradient-bg section-animate">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center content-layer">
            <h2 class="text-4xl font-bold gradient-text mb-8">Fale Conosco</h2>
            <p class="text-xl text-gray-200 max-w-3xl mx-auto mb-8 fade-in">Vamos criar algo incrível juntos! Envie sua mensagem pelo chat abaixo.</p>
            <div class="chat-container">
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input" id="chatInput">
                    <textarea id="userInput" placeholder="Digite sua resposta..." rows="1" onkeypress="handleKeyPress(event)"></textarea>
                    <div class="input-actions">
                        <div class="file-upload">
                            <label for="fileInput" class="cursor-pointer">
                                <svg class="inline-block w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 002.828 2.828l6.586-6.586a4 4 0 00-5.656-5.656L5.757 10.757a6 6 0 008.486 8.486L21 12"></path></svg>
                                Anexar Arquivo
                            </label>
                            <input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg,.png" class="hidden" onchange="handleFileSelect(event)">
                        </div>
                        <button onclick="sendMessage()">Enviar</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="section-bg text-gray-200 py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center content-layer">
            <p>© 2025 Good Vibes. Todos os direitos reservados.</p>
        </div>
    </footer>

    <!-- Inactivity Card -->
    <div class="inactivity-card" id="inactivityCard">
        <button class="close-btn" onclick="hideInactivityCard()">×</button>
        <h3 class="gradient-text">Seu Site Ideal Começa Aqui</h3>
        <p>Quer saber quanto vai custar? Conta pra gente sua ideia — juntos, descobrimos o melhor caminho pro seu projeto. Mande mensagem agora!</p>
        <a href="#contact" onclick="hideInactivityCard();"><button>Fale Conosco</button></a>
    </div>

    <script>
        // Smooth scroll for nav links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });

        // Fade-in animation on scroll
        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('fade-in');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });
        document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));

        // Section slide-in/slide-out animation
        const sectionObserver = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                } else {
                    entry.target.classList.remove('visible');
                }
            });
        }, { threshold: 0.2 });
        document.querySelectorAll('.section-animate').forEach(section => sectionObserver.observe(section));

        // Particles.js configuration
        particlesJS('particles-js', {
            particles: {
                number: { value: 200, density: { enable: true, value_area: 800 } },
                color: { value: ['#a5b4fc', '#e879f9', '#f472b6'] },
                shape: { type: 'circle' },
                opacity: { value: 0.8, random: false },
                size: { value: 4, random: true },
                line_linked: {
                    enable: true,
                    distance: 120,
                    color: '#e879f9',
                    opacity: 0.6,
                    width: 1
                },
                move: {
                    enable: true,
                    speed: 1,
                    direction: 'none',
                    random: true,
                    straight: false,
                    out_mode: 'out',
                    bounce: false
                }
            },
            interactivity: {
                detect_on: 'canvas',
                events: {
                    onhover: { enable: true, mode: 'repulse' },
                    onclick: { enable: true, mode: 'push' },
                    resize: true
                },
                modes: {
                    repulse: { distance: 50, duration: 0.1 },
                    push: { particles_nb: 6 }
                }
            },
            retina_detect: true
        });

        // Inactivity Card Logic
        const inactivityCard = document.getElementById('inactivityCard');
        let inactivityTimeout;
        let hasShown = false;

        function showInactivityCard() {
            if (!hasShown) {
                inactivityCard.style.display = 'block';
                hasShown = true;
            }
        }

        function hideInactivityCard() {
            inactivityCard.style.display = 'none';
            clearTimeout(inactivityTimeout);
        }

        function resetInactivityTimer() {
            if (!hasShown) {
                clearTimeout(inactivityTimeout);
                inactivityTimeout = setTimeout(showInactivityCard, 5000);
            }
        }

        resetInactivityTimer();

        ['mousemove', 'keydown', 'scroll', 'click'].forEach(event => {
            document.addEventListener(event, resetInactivityTimer);
        });

        // Chat Logic
        let chatMessages = document.getElementById('chatMessages');
        let userInput = document.getElementById('userInput');
        let fileInput = document.getElementById('fileInput');
        let fileUpload = document.querySelector('.file-upload');
        let chatState = {
            step: 1,
            name: '',
            email: '',
            whatsapp: '',
            message: '',
            file: null,
            wantsFile: null,
            confirmingFile: false
        };
        let isBotTyping = false;
        let hasGreeted = false;
        let isCorrecting = false;
        let fieldToCorrect = null;

        const commonGreetings = [
            'oi', 'olá', 'ola', 'bom dia', 'boa tarde', 'boa noite',
            'tudo bem', 'tudo bom', 'como vai', 'e aí', 'e ai', 'eai',
            'oiê', 'oie', 'oiee', 'oláá', 'olaa', 'oláa', 'tô de boa',
            'tô bem', 'tô de boa?', 'tô bem?', 'como você está',
            'como você ta', 'como você tá', 'e você', 'e tu', 'e voce',
            'opa'
        ];

        const botGreetings = [
            'Que bom te ver! 😊',
            'Seja bem-vindo! 😊',
            'É um prazer te conhecer! 😊',
            'Fico feliz em te ajudar hoje! 😊'
        ];

        const correctionKeywords = [
            'errei', 'ops', 'opa', 'eita', 'está errado', 'esta errado',
            'está errada', 'esta errada', 'corrigir', 'alterar', 'trocar'
        ];

        const fieldKeywords = {
            name: ['nome', 'meu nome'],
            email: ['email', 'e-mail', 'mail'],
            whatsapp: ['whatsapp', 'whats', 'telefone', 'número', 'numero']
        };

        const affirmativeResponses = ['sim', 's', 'ok', 'certo', 'claro', 'pode ser', 'tá bom', 'ta bom', 'tá', 'ta'];
        const negativeResponses = ['não', 'nao', 'n', 'de jeito nenhum', 'nada disso', 'nem', 'nunca'];

        function isGreeting(message) {
            const normalizedMessage = message.toLowerCase().trim();
            return commonGreetings.some(greeting => 
                normalizedMessage === greeting || 
                normalizedMessage.startsWith(greeting + ' ') || 
                normalizedMessage.endsWith(' ' + greeting) ||
                normalizedMessage.includes(' ' + greeting + ' ')
            );
        }

        function isValidName(name) {
            const normalizedName = name.trim();
            const nameRegex = /^[a-zA-ZÀ-ÿ\s-]+$/;
            return (
                nameRegex.test(normalizedName) &&
                normalizedName.length <= 50 &&
                !normalizedName.includes(',') &&
                !normalizedName.includes('?') &&
                !normalizedName.includes('!')
            );
        }

        function isAffirmative(message) {
            const normalizedMessage = message.toLowerCase().trim();
            return affirmativeResponses.some(response => normalizedMessage.includes(response));
        }

        function isNegative(message) {
            const normalizedMessage = message.toLowerCase().trim();
            return negativeResponses.some(response => normalizedMessage.includes(response));
        }

        function selectBotGreeting(userGreeting) {
            const normalizedUserGreeting = userGreeting.toLowerCase().trim();
            let availableGreetings = botGreetings;
            const userGreetingWords = normalizedUserGreeting.split(' ');
            availableGreetings = botGreetings.filter(greeting => {
                const greetingWords = greeting.toLowerCase().split(' ');
                return !userGreetingWords.some(word => greetingWords.includes(word));
            });
            if (availableGreetings.length === 0) {
                availableGreetings = botGreetings;
            }
            return availableGreetings[Math.floor(Math.random() * availableGreetings.length)];
        }

        function detectCorrectionRequest(message) {
            const normalizedMessage = message.toLowerCase().trim();
            const isCorrection = correctionKeywords.some(keyword => 
                normalizedMessage.includes(keyword)
            );

            if (!isCorrection) return null;

            for (const [field, keywords] of Object.entries(fieldKeywords)) {
                if (keywords.some(keyword => normalizedMessage.includes(keyword))) {
                    return field;
                }
            }

            return null;
        }

        function askForCorrectedData(field) {
            let question;
            switch (field) {
                case 'name':
                    question = "Qual seria o nome correto?";
                    break;
                case 'email':
                    question = "Qual seria o e-mail correto?";
                    break;
                case 'whatsapp':
                    question = "Qual seria o número de WhatsApp correto?";
                    break;
                default:
                    question = "Desculpe, não entendi qual dado você quer corrigir. Pode especificar?";
            }
            showTypingIndicator();
            setTimeout(() => {
                removeTypingIndicator();
                addBotMessage(question);
            }, 2000);
        }

        function toggleFileUpload(show) {
            if (show) {
                fileUpload.classList.add('visible');
            } else {
                fileUpload.classList.remove('visible');
            }
        }

        function continueFlow() {
            showTypingIndicator();
            setTimeout(() => {
                removeTypingIndicator();
                if (chatState.step === 1) {
                    addBotMessage("Olá! Sou o assistente da Good Vibes. 😊 Qual é o seu nome ou como você gostaria de ser chamado?");
                } else if (chatState.step === 2) {
                    addBotMessage(`Prazer em conhecê-lo, ${chatState.name}! Qual é o seu e-mail de contato?`);
                } else if (chatState.step === 3) {
                    addBotMessage("Ótimo! Qual é o seu número de WhatsApp?");
                } else if (chatState.step === 4) {
                    addBotMessage("Perfeito! Agora, qual é a mensagem que você gostaria de enviar?");
                    userInput.placeholder = "Digite sua mensagem...";
                    userInput.rows = 3;
                } else if (chatState.step === 5) {
                    addBotMessage("Você gostaria de anexar um arquivo como referência do seu projeto? (Aceitamos PDF, JPG, JPEG, PNG, com até 5MB). Digite 'sim' ou 'não'.");
                    userInput.placeholder = "Digite 'sim' ou 'não'...";
                    userInput.rows = 1;
                } else if (chatState.step === 6 && chatState.wantsFile) {
                    addBotMessage("Por favor, anexe o arquivo clicando no botão 'Anexar Arquivo'.");
                    userInput.placeholder = "Aguardando arquivo...";
                    userInput.disabled = true;
                    toggleFileUpload(true); // Exibe o botão de upload
                }
                saveChatState();
            }, 2000);
        }

        window.onload = function() {
            localStorage.removeItem('chatState');
            chatState = {
                step: 1,
                name: '',
                email: '',
                whatsapp: '',
                message: '',
                file: null,
                wantsFile: null,
                confirmingFile: false
            };
            hasGreeted = false;
            chatMessages.innerHTML = '';
            const chatContainer = document.querySelector('.chat-container');
            chatContainer.innerHTML = `
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input" id="chatInput">
                    <textarea id="userInput" placeholder="Digite sua resposta..." rows="1" onkeypress="handleKeyPress(event)"></textarea>
                    <div class="input-actions">
                        <div class="file-upload">
                            <label for="fileInput" class="cursor-pointer">
                                <svg class="inline-block w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 002.828 2.828l6.586-6.586a4 4 0 00-5.656-5.656L5.757 10.757a6 6 0 008.486 8.486L21 12"></path></svg>
                                Anexar Arquivo
                            </label>
                            <input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg,.png" class="hidden" onchange="handleFileSelect(event)">
                        </div>
                        <button onclick="sendMessage()">Enviar</button>
                    </div>
                </div>
            `;
            chatMessages = document.getElementById('chatMessages');
            userInput = document.getElementById('userInput');
            fileInput = document.getElementById('fileInput');
            fileUpload = document.querySelector('.file-upload');
            toggleFileUpload(false); // Oculta o botão de upload inicialmente
        };

        function loadChatState() {
            const savedState = localStorage.getItem('chatState');
            if (savedState) {
                chatState = JSON.parse(savedState);
                restoreChat();
            }
        }

        function saveChatState() {
            const stateToSave = { ...chatState, file: null }; // Não salva o arquivo no localStorage
            localStorage.setItem('chatState', JSON.stringify(stateToSave));
        }

        function restoreChat() {
            chatMessages.innerHTML = '';
            toggleFileUpload(false); // Garante que o botão esteja oculto inicialmente
            if (chatState.step >= 1) {
                addBotMessage("Olá! Sou o assistente da Good Vibes. 😊 Qual é o seu nome ou como você gostaria de ser chamado?");
                if (chatState.name) {
                    addUserMessage(chatState.name);
                }
            }
            if (chatState.step >= 2) {
                addBotMessage(`Prazer em conhecê-lo, ${chatState.name}! Qual é o seu e-mail de contato?`);
                if (chatState.email) {
                    addUserMessage(chatState.email);
                }
            }
            if (chatState.step >= 3) {
                addBotMessage("Ótimo! Qual é o seu número de WhatsApp?");
                if (chatState.whatsapp) {
                    addUserMessage(chatState.whatsapp);
                }
            }
            if (chatState.step >= 4) {
                addBotMessage("Perfeito! Agora, qual é a mensagem que você gostaria de enviar?");
                if (chatState.message) {
                    addUserMessage(chatState.message);
                }
            }
            if (chatState.step >= 5) {
                addBotMessage("Você gostaria de anexar um arquivo como referência do seu projeto? (Aceitamos PDF, JPG, JPEG, PNG, com até 5MB). Digite 'sim' ou 'não'.");
                if (chatState.wantsFile !== null) {
                    addUserMessage(chatState.wantsFile ? 'sim' : 'não');
                }
            }
            if (chatState.step >= 6 && chatState.wantsFile) {
                addBotMessage("Por favor, anexe o arquivo clicando no botão 'Anexar Arquivo'.");
                toggleFileUpload(true); // Exibe o botão de upload se o usuário quis anexar
            }
            scrollToBottom();
        }

        function addBotMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', 'bot-message');
            messageElement.textContent = message;
            chatMessages.appendChild(messageElement);
            scrollToBottom();
        }

        function addUserMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', 'user-message');
            messageElement.textContent = message;
            chatMessages.appendChild(messageElement);
            scrollToBottom();
        }

        function showTypingIndicator() {
            const typingElement = document.createElement('div');
            typingElement.classList.add('typing-indicator');
            typingElement.innerHTML = '<span></span><span></span><span></span>';
            typingElement.id = 'typingIndicator';
            chatMessages.appendChild(typingElement);
            scrollToBottom();
            isBotTyping = true;
        }

        function removeTypingIndicator() {
            const typingElement = document.getElementById('typingIndicator');
            if (typingElement) {
                typingElement.remove();
            }
            isBotTyping = false;
        }

        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function isValidPhoneNumber(phone) {
            const phoneRegex = /^\+?[\d\s()-]{7,}$/;
            return phoneRegex.test(phone);
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validar tamanho do arquivo (máx 5MB)
            if (file.size > 5 * 1024 * 1024) {
                showTypingIndicator();
                setTimeout(() => {
                    removeTypingIndicator();
                    addBotMessage("O arquivo é muito grande. Por favor, selecione um arquivo com até 5MB.");
                    fileInput.value = '';
                }, 2000);
                return;
            }

            chatState.file = file;
            const fileType = file.name.toLowerCase().endsWith('.pdf') ? 'PDF' : 'imagem';
            showTypingIndicator();
            setTimeout(() => {
                removeTypingIndicator();
                addBotMessage(`Você anexou um ${fileType}: "${file.name}". É esse o arquivo correto? Digite 'sim' ou 'não'.`);
                chatState.confirmingFile = true;
                userInput.placeholder = "Digite 'sim' ou 'não'...";
                userInput.rows = 1;
                userInput.disabled = false;
                saveChatState();
            }, 2000);
        }

        const contactSectionObserver = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting && !hasGreeted && chatState.step === 1 && !chatState.name) {
                    console.log("Contact section is visible, triggering greeting...");
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Olá! Sou o assistente da Good Vibes. 😊 Qual é o seu nome ou como você gostaria de ser chamado?");
                        hasGreeted = true;
                        saveChatState();
                    }, 3000);
                }
            });
        }, { threshold: 0.3 });

        function sendMessage() {
            if (isBotTyping) return;

            const userText = userInput.value.trim();
            if (!userText) return;

            const correctionField = detectCorrectionRequest(userText);
            if (correctionField && chatState.step < 5) {
                addUserMessage(userText);
                fieldToCorrect = correctionField;
                isCorrecting = true;
                askForCorrectedData(correctionField);
                userInput.value = '';
                return;
            }

            if (isCorrecting) {
                addUserMessage(userText);
                let isValid = true;
                let errorMessage = '';

                if (fieldToCorrect === 'name') {
                    if (isValidName(userText)) {
                        chatState.name = userText;
                    } else {
                        isValid = false;
                        errorMessage = "Desculpe, não sei se esse é o seu nome. 😅 Pode me dizer um nome válido?";
                    }
                } else if (fieldToCorrect === 'email') {
                    if (isValidEmail(userText)) {
                        chatState.email = userText;
                    } else {
                        isValid = false;
                        errorMessage = "Desculpe, isso não parece ser um e-mail válido. Por favor, insira um e-mail válido (exemplo: seuemail@dominio.com).";
                    }
                } else if (fieldToCorrect === 'whatsapp') {
                    if (isValidPhoneNumber(userText)) {
                        chatState.whatsapp = userText;
                    } else {
                        isValid = false;
                        errorMessage = "Desculpe, isso não parece ser um número de telefone válido. Por favor, insira um número de WhatsApp válido (exemplo: +5511999999999).";
                    }
                }

                if (isValid) {
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Dado corrigido com sucesso! 😊");
                        isCorrecting = false;
                        fieldToCorrect = null;
                        continueFlow();
                    }, 2000);
                } else {
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage(errorMessage);
                    }, 2000);
                }
                userInput.value = '';
                saveChatState();
                return;
            }

            if (chatState.step === 1) {
                addUserMessage(userText);
                if (isGreeting(userText)) {
                    const botGreeting = selectBotGreeting(userText);
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage(`${botGreeting} Qual é o seu nome ou como você gostaria de ser chamado?`);
                    }, 2000);
                } else if (isValidName(userText)) {
                    chatState.name = userText;
                    chatState.step = 2;
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage(`Prazer em conhecê-lo, ${chatState.name}! Qual é o seu e-mail de contato?`);
                        saveChatState();
                    }, 2000);
                } else {
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Desculpe, não sei se esse é o seu nome. 😅 Pode me dizer seu nome ou como você gostaria de ser chamado?");
                    }, 2000);
                }
            } else if (chatState.step === 2) {
                if (isValidEmail(userText)) {
                    chatState.email = userText;
                    addUserMessage(userText);
                    chatState.step = 3;
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Ótimo! Qual é o seu número de WhatsApp?");
                        saveChatState();
                    }, 2000);
                } else {
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Desculpe, isso não parece ser um e-mail válido. Por favor, insira um e-mail válido (exemplo: seuemail@dominio.com).");
                    }, 2000);
                }
            } else if (chatState.step === 3) {
                if (isValidPhoneNumber(userText)) {
                    chatState.whatsapp = userText;
                    addUserMessage(userText);
                    chatState.step = 4;
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Perfeito! Agora, qual é a mensagem que você gostaria de enviar?");
                        userInput.placeholder = "Digite sua mensagem...";
                        userInput.rows = 3;
                        saveChatState();
                    }, 2000);
                } else {
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Desculpe, isso não parece ser um número de telefone válido. Por favor, insira um número de WhatsApp válido (exemplo: +5511999999999).");
                    }, 2000);
                }
            } else if (chatState.step === 4) {
                chatState.message = userText;
                addUserMessage(userText);
                chatState.step = 5;
                showTypingIndicator();
                setTimeout(() => {
                    removeTypingIndicator();
                    continueFlow();
                }, 2000);
            } else if (chatState.step === 5) {
                addUserMessage(userText);
                if (isAffirmative(userText)) {
                    chatState.wantsFile = true;
                    chatState.step = 6;
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        continueFlow();
                    }, 2000);
                } else if (isNegative(userText)) {
                    chatState.wantsFile = false;
                    chatState.step = 7;
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Entendido! Enviando sua mensagem...");
                        sendToGoogleForms();
                    }, 2000);
                } else {
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Por favor, responda com 'sim' ou 'não'.");
                    }, 2000);
                }
            } else if (chatState.step === 6 && chatState.confirmingFile) {
                addUserMessage(userText);
                if (isAffirmative(userText)) {
                    chatState.confirmingFile = false;
                    chatState.step = 7;
                    toggleFileUpload(false); // Oculta o botão após confirmação
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Entendido! Enviando sua mensagem...");
                        sendToGoogleForms();
                    }, 2000);
                } else if (isNegative(userText)) {
                    chatState.file = null;
                    chatState.confirmingFile = false;
                    fileInput.value = '';
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Por favor, anexe outro arquivo clicando no botão 'Anexar Arquivo'.");
                        userInput.placeholder = "Aguardando arquivo...";
                        userInput.disabled = true;
                    }, 2000);
                } else {
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Por favor, responda com 'sim' ou 'não'.");
                    }, 2000);
                }
            }

            userInput.value = '';
            saveChatState();
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function sendToGoogleForms() {
            const formData = new URLSearchParams();
            formData.append('entry.2005620554', chatState.name);
            formData.append('entry.1045781291', chatState.email);
            formData.append('entry.1166974658', chatState.whatsapp);
            formData.append('entry.839337160', chatState.message);

            fetch('https://docs.google.com/forms/d/e/1FAIpQLScKWel3h02lk-LOA1QmwDuch_StBA7aQ6VSeHZALjk76H2PEA/formResponse', {
                method: 'POST',
                body: formData,
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                mode: 'no-cors'
            })
            .then(() => {
                console.log("Google Forms request sent:", {
                    name: chatState.name,
                    email: chatState.email,
                    whatsapp: chatState.whatsapp,
                    message: chatState.message,
                    file: chatState.file ? chatState.file.name : 'Nenhum arquivo'
                });
                showSuccessMessage();
            })
            .catch(error => {
                console.error("Google Forms request error:", error);
                addBotMessage("Desculpe, houve um erro ao enviar sua mensagem. Tente novamente mais tarde.");
            });
        }

        function showSuccessMessage() {
            chatMessages.innerHTML = '';
            const chatContainer = document.querySelector('.chat-container');
            chatContainer.classList.add('success');
            const successMessage = `Mensagem Enviada! ✨`;
            chatContainer.innerHTML = `
                <div class="chat-messages" id="chatMessages">
                    <div class="sparkle-text">${successMessage}</div>
                </div>
            `;
            chatMessages = document.getElementById('chatMessages');
            localStorage.removeItem('chatState');
            chatState = {
                step: 1,
                name: '',
                email: '',
                whatsapp: '',
                message: '',
                file: null,
                wantsFile: null,
                confirmingFile: false
            };
            toggleFileUpload(false); // Garante que o botão esteja oculto após o sucesso
        }

        loadChatState();

        document.addEventListener('DOMContentLoaded', () => {
            const contactSection = document.querySelector('#contact');
            if (contactSection) {
                contactSectionObserver.observe(contactSection);
                console.log("IntersectionObserver started for contact section.");
            } else {
                console.error("Contact section not found!");
            }
        });
    </script>
</body>
</html>
