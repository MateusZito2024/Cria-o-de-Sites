<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Good Vibes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@400;600&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            position: relative;
            overflow-x: hidden;
            background: transparent;
        }

        /* Header Styles */
        .brand-name {
            font-family: 'Great Vibes', cursive;
            line-height: 2;
            padding: 1rem;
            display: block;
            overflow: visible;
        }

        .flex.items-center.content-layer {
            overflow: visible;
        }

        .nav-link {
            font-family: 'Montserrat', sans-serif;
            position: relative;
            text-decoration: none;
            color: #f8f8f8;
            transition: color 0.3s ease;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -4px;
            left: 0;
            background: linear-gradient(135deg, #a5b4fc, #e879f9);
            transition: width 0.3s ease;
        }

        .nav-link:hover::after {
            width: 100%;
        }

        .nav-link:hover {
            color: #e879f9;
        }

        .gradient-text {
            background: linear-gradient(135deg, #a5b4fc, #e879f9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        nav {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 10;
            background: transparent;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 0 1rem;
        }

        nav > div {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        nav .flex.items-center.content-layer:first-child {
            margin-right: auto;
        }

        nav .flex.items-center.content-layer:last-child {
            margin-left: auto;
        }

        nav, section, footer {
            position: relative;
            z-index: 1;
            pointer-events: none;
        }

        nav *, section *, footer * {
            pointer-events: auto;
        }

        .content-layer {
            position: relative;
            z-index: 2;
        }

        h1, h2, h3, p, a, input, textarea, button, img, svg {
            position: relative;
            z-index: 30;
            opacity: 1 !important;
        }

        /* Remaining Styles */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-50px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideOut {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(50px); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        @keyframes stretch {
            0% { transform: scaleY(1); }
            50% { transform: scaleY(1.1); }
            100% { transform: scaleY(1); }
        }

        @keyframes fadeInTooltip {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeOutTooltip {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(5px); }
        }

        .fade-in {
            opacity: 1 !important;
            animation: fadeInUp 1s ease-out forwards;
        }

        .section-animate {
            opacity: 1 !important;
        }

        .section-animate.visible {
            animation: slideIn 0.8s ease-out forwards;
        }

        .section-animate:not(.visible) {
            animation: slideOut 0.8s ease-out forwards;
        }

        .service-item, .portfolio-item {
            animation: pulse 3s infinite ease-in-out;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            z-index: 30;
            background: #4b5563;
            border: 3px solid #a5b4fc;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            opacity: 1 !important;
        }

        .service-item:hover, .portfolio-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(168, 85, 247, 0.5);
            background: linear-gradient(135deg, #374151, #4b5563);
            animation: stretch 0.6s ease-in-out, pulse 3s infinite ease-in-out;
        }

        .portfolio-item .overlay {
            transition: opacity 0.3s ease, background 0.3s ease;
            z-index: 30;
            opacity: 0;
        }

        .portfolio-item:hover .overlay {
            opacity: 1;
            background: linear-gradient(135deg, rgba(165, 180, 252, 0.3), rgba(232, 121, 249, 0.3));
        }

        .gradient-bg {
            background: transparent;
        }

        .section-bg {
            background: rgba(31, 41, 55, 0.8);
        }

        #particles-js {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: #0d1117;
        }

        .service-icon {
            fill: url(#gradient);
            width: 48px;
            height: 48px;
            margin-bottom: 1rem;
        }

        /* Estilos para o card de inatividade */
        .inactivity-card {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #374151;
            background-image: url('https://img.lovepik.com/free-png/20211126/lovepik-computer-and-mobile-phone-png-image_401144716_wh1200.png');
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            text-align: center;
            max-width: 500px;
            width: 90%;
        }

        .inactivity-card h3 {
            font-size: 1.5rem;
            font-weight: bold;
            color: #e879f9;
            margin-bottom: 1rem;
        }

        .inactivity-card p {
            color: #a5b4fc;
            margin-bottom: 1.5rem;
            background: rgba(55, 65, 81, 0.7);
            padding: 0.5rem;
            border-radius: 0.5rem;
        }

        .inactivity-card button {
            background: #e879f9;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .inactivity-card button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(232, 121, 249, 0.5);
        }

        .inactivity-card .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: #a5b4fc;
            font-size: 1.5rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            border-radius: 50%;
            transition: color 0.3s ease, background 0.3s ease;
            padding: 0;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .inactivity-card .close-btn:hover {
            color: #e879f9;
            background: rgba(255, 255, 255, 0.1);
        }

        /* Estilos para o chat */
        .chat-container {
            max-width: 600px;
            margin: 0 auto;
            background: #374151;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            height: 500px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .chat-container.success {
            background: transparent;
            padding: 0;
            border-radius: 0;
            box-shadow: none;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            max-width: 70%;
            padding: 0.75rem;
            border-radius: 0.75rem;
            line-height: 1.5;
        }

        .bot-message {
            background: #4b5563;
            color: #e2e8f0;
            align-self: flex-start;
            border-bottom-left-radius: 0;
        }

        .user-message {
            background: #a5b4fc;
            color: #1f2937;
            align-self: flex-end;
            border-bottom-right-radius: 0;
        }

        .typing-indicator {
            display: flex;
            gap: 0.3rem;
            align-self: flex-start;
            padding: 0.75rem;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: #a5b4fc;
            border-radius: 50%;
            animation: bounce 0.6s infinite alternate;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-5px); }
        }

        .chat-input {
            display: flex;
            gap: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #4b5563;
            align-items: center;
            position: relative;
        }

        .chat-input textarea {
            flex: 1;
            padding: 0.75rem;
            background: #4b5563;
            color: #e2e8f0;
            border: 1px solid #a5b4fc;
            border-radius: 0.5rem;
            outline: none;
            resize: none;
            font-family: 'Poppins', sans-serif;
        }

        .chat-input button {
            background: #e879f9;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .chat-input button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(232, 121, 249, 0.5);
        }

        .mic-button {
            background: #a5b4fc;
            color: white;
            padding: 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .mic-button.recording {
            background: #e879f9;
            transform: scale(1.1);
        }

        .mic-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(165, 180, 252, 0.5);
        }

        .mic-button:disabled {
            background: #6b7280;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .mic-button svg {
            width: 24px;
            height: 24px;
        }

        .mic-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #374151;
            color: #e2e8f0;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            white-space: nowrap;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            z-index: 40;
            animation: fadeInTooltip 0.3s ease-in-out forwards;
        }

        .mic-tooltip.fade-out {
            animation: fadeOutTooltip 0.3s ease-in-out forwards;
        }

        .mic-tooltip .gradient-text {
            font-weight: bold;
        }

        /* Estilo para o texto cintilante */
        .sparkle-text {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            color: #e2e8f0;
            background: linear-gradient(90deg, #a5b4fc, #e879f9, #a5b4fc);
            background-size: 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: sparkle 2s infinite, fadeIn 0.5s ease-in-out;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
        }

        @keyframes sparkle {
            0% { background-position: 0%; }
            50% { background-position: 200%; }
            100% { background-position: 0%; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body class="text-gray-100">
    <!-- Interactive Background -->
    <div id="particles-js"></div>

    <!-- SVG Gradient for Icons -->
    <svg width="0" height="0">
        <defs>
            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#a5b4fc;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#e879f9;stop-opacity:1" />
            </linearGradient>
        </defs>
    </svg>

    <!-- Navbar -->
    <nav class="shadow-lg fixed w-full z-10">
        <div class="flex justify-between h-16">
            <div class="flex items-center content-layer">
                <h1 class="text-4xl brand-name gradient-text">Good Vibes</h1>
            </div>
            <div class="flex items-center space-x-6 content-layer">
                <a href="https://mateuszito2024.github.io/Cria-o-de-Sites/index.html" class="nav-link text-lg transition">Início</a>
                <a href="https://mateuszito2024.github.io/Cria-o-de-Sites/servi%C3%A7os.html" class="nav-link text-lg transition">Serviços</a>
                <a href="https://mateuszito2024.github.io/Cria-o-de-Sites/sobre.html" class="nav-link text-lg transition">Sobre</a>
                <a href="https://mateuszito2024.github.io/Cria-o-de-Sites/portf%C3%B3lio.html" class="nav-link text-lg transition">Portfólio</a>
                <a href="https://mateuszitoobjs2024.github.io/Cria-o-de-Sites/contato.html" class="nav-link text-lg transition">Contato</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="min-h-screen flex items-center gradient-bg section-animate">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center fade-in content-layer">
            <h2 class="text-5xl md:text-7xl font-bold gradient-text">Eleve Sua Marca</h2>
            <p class="mt-4 text-xl md:text-2xl text-gray-200">Soluções digitais com criatividade e impacto.</p>
            <a href="#contact" class="mt-6 inline-block bg-indigo-500 text-white font-semibold py-3 px-8 rounded-full service-item transition">Comece Agora</a>
        </div>
    </section>

    <!-- Services Section -->
    <section id="services" class="py-20 section-bg section-animate">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 content-layer">
            <h2 class="text-4xl font-bold text-center gradient-text mb-12">Nossos Serviços</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="service-item p-6 rounded-xl transition fade-in text-center">
                    <img src="https://i.postimg.cc/wjGtqTVm/pngegg-1.png" alt="Ícone Marketing Digital" class="service-icon mx-auto">
                    <h3 class="text-2xl font-semibold gradient-text mb-4">Marketing Digital</h3>
                    <p class="text-gray-300">Campanhas estratégicas para engajar e converter seu público-alvo.</p>
                </div>
                <div class="service-item p-6 rounded-xl transition fade-in text-center" style="animation-delay: 0.2s;">
                    <img src="https://i.postimg.cc/YqgkG2MF/pngegg-2.png" alt="Ícone Desenvolvimento Web" class="service-icon mx-auto">
                    <h3 class="text-2xl font-semibold gradient-text mb-4">Desenvolvimento Web</h3>
                    <p class="text-gray-300">Sites dinâmicos e responsivos que refletem sua marca.</p>
                </div>
                <div class="service-item p-6 rounded-xl transition fade-in text-center" style="animation-delay: 0.4s;">
                    <img src="https://i.postimg.cc/63Gbj3HL/pngegg-3.png" alt="Ícone Design Gráfico" class="service-icon mx-auto">
                    <h3 class="text-2xl font-semibold gradient-text mb-4">Design Gráfico</h3>
                    <p class="text-gray-300">Visuais únicos que contam a história da sua marca.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="py-20 section-bg section-animate">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center content-layer">
            <h2 class="text-4xl font-bold gradient-text mb-8">Quem Somos</h2>
            <p class="text-xl text-gray-300 max-w-3xl mx-auto fade-in">Na Good Vibes, transformamos visões em realidade com criatividade e inovação. Nossa equipe é apaixonada por criar experiências digitais que inspiram.</p>
        </div>
    </section>

    <!-- Portfolio Section -->
    <section id="portfolio" class="py-20 section-bg section-animate">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 content-layer">
            <h2 class="text-4xl font-bold text-center gradient-text mb-12">Portfólio</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="portfolio-item relative overflow-hidden rounded-xl transition fade-in">
                    <img src="https://i.postimg.cc/kGd1LsST/Prancheta-18.png" alt="Projeto 1 - Flow Digital" class="w-full h-64 object-cover">
                    <div class="overlay absolute inset-0 flex items-center justify-center">
                        <!-- Texto removido -->
                    </div>
                </div>
                <div class="portfolio-item relative overflow-hidden rounded-xl transition fade-in" style="animation-delay: 0.2s;">
                    <img src="https://i.postimg.cc/D0ZJfk10/Prancheta-7.png" alt="Projeto 2 - Dra Mari Alves" class="w-full h-64 object-cover">
                    <div class="overlay absolute inset-0 flex items-center justify-center">
                        <!-- Texto removido -->
                    </div>
                </div>
                <div class="portfolio-item relative overflow-hidden rounded-xl transition fade-in" style="animation-delay: 0.4s;">
                    <img src="https://i.postimg.cc/fLHyr21N/Prancheta-1.png" alt="Projeto 3 - Viraliza Tráfego" class="w-full h-64 object-cover">
                    <div class="overlay absolute inset-0 flex items-center justify-center">
                        <!-- Texto removido -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section (Transformed into Chat) -->
    <section id="contact" class="py-20 gradient-bg section-animate">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center content-layer">
            <h2 class="text-4xl font-bold gradient-text mb-8">Fale Conosco</h2>
            <p class="text-xl text-gray-200 max-w-3xl mx-auto mb-8 fade-in">Vamos criar algo incrível juntos! Envie sua mensagem pelo chat abaixo.</p>
            <div class="chat-container">
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input" id="chatInput">
                    <textarea id="userInput" placeholder="Digite sua resposta..." rows="1" onkeypress="handleKeyPress(event)"></textarea>
                    <button class="mic-button" id="micButton" title="Segure para gravar" onmousedown="startRecording(event)" onmouseup="stopRecording()" ontouchstart="startRecording(event)" ontouchend="stopRecording()">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5zm6 6c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.47 6 6.93V22h2v-3.07c3.39-.46 6-3.4 6-6.93h-2z"/>
                        </svg>
                    </button>
                    <button onclick="sendMessage()">Enviar</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="section-bg text-gray-200 py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center content-layer">
            <p>© 2025 Good Vibes. Todos os direitos reservados.</p>
        </div>
    </footer>

    <!-- Inactivity Card -->
    <div class="inactivity-card" id="inactivityCard">
        <button class="close-btn" onclick="hideInactivityCard()">×</button>
        <h3 class="gradient-text">Seu Site Ideal Começa Aqui</h3>
        <p>Quer saber quanto vai custar? Conta pra gente sua ideia — juntos, descobrimos o melhor caminho pro seu projeto. Mande mensagem agora!</p>
        <a href="#contact" onclick="hideInactivityCard();"><button>Fale Conosco</button></a>
    </div>

    <script>
        // Smooth scroll for nav links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });

        // Fade-in animation on scroll
        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('fade-in');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });
        document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));

        // Section slide-in/slide-out animation
        const sectionObserver = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                } else {
                    entry.target.classList.remove('visible');
                }
            });
        }, { threshold: 0.2 });
        document.querySelectorAll('.section-animate').forEach(section => sectionObserver.observe(section));

        // Particles.js configuration
        particlesJS('particles-js', {
            particles: {
                number: { value: 200, density: { enable: true, value_area: 800 } },
                color: { value: ['#a5b4fc', '#e879f9', '#f472b6'] },
                shape: { type: 'circle' },
                opacity: { value: 0.8, random: false },
                size: { value: 4, random: true },
                line_linked: {
                    enable: true,
                    distance: 120,
                    color: '#e879f9',
                    opacity: 0.6,
                    width: 1
                },
                move: {
                    enable: true,
                    speed: 1,
                    direction: 'none',
                    random: true,
                    straight: false,
                    out_mode: 'out',
                    bounce: false
                }
            },
            interactivity: {
                detect_on: 'canvas',
                events: {
                    onhover: { enable: true, mode: 'repulse' },
                    onclick: { enable: true, mode: 'push' },
                    resize: true
                },
                modes: {
                    repulse: { distance: 50, duration: 0.1 },
                    push: { particles_nb: 6 }
                }
            },
            retina_detect: true
        });

        // Inactivity Card Logic
        const inactivityCard = document.getElementById('inactivityCard');
        let inactivityTimeout;
        let hasShown = false;

        function showInactivityCard() {
            if (!hasShown) {
                inactivityCard.style.display = 'block';
                hasShown = true;
            }
        }

        function hideInactivityCard() {
            inactivityCard.style.display = 'none';
            clearTimeout(inactivityTimeout);
        }

        function resetInactivityTimer() {
            if (!hasShown) {
                clearTimeout(inactivityTimeout);
                inactivityTimeout = setTimeout(showInactivityCard, 5000);
            }
        }

        resetInactivityTimer();

        ['mousemove', 'keydown', 'scroll', 'click'].forEach(event => {
            document.addEventListener(event, resetInactivityTimer);
        });

        // Chat Logic
        let chatMessages = document.getElementById('chatMessages');
        let userInput = document.getElementById('userInput');
        let chatState = {
            step: 1,
            name: '',
            email: '',
            whatsapp: '',
            message: '',
            gender: null // 'masculine', 'feminine', or null (not set)
        };
        let isBotTyping = false;
        let hasGreeted = false;
        let isCorrecting = false;
        let fieldToCorrect = null;

        // Speech Recognition Setup
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition = null;
        let isRecording = false;
        let pressStartTime = null;

        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.lang = 'pt-BR';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                userInput.value = transcript;
                sendMessage();
            };

            recognition.onerror = function(event) {
                console.error('Speech recognition error:', event.error);
                const micButton = document.getElementById('micButton');
                micButton.classList.remove('recording');
                isRecording = false;
                userInput.placeholder = chatState.step === 4 ? "Digite sua mensagem..." : "Digite sua resposta...";
                // Suppress all error messages to prevent chat flooding
                if (event.error === 'not-allowed' || event.error === 'service-not-allowed') {
                    micButton.disabled = true;
                    micButton.title = "Microfone não disponível";
                }
            };

            recognition.onend = function() {
                const micButton = document.getElementById('micButton');
                micButton.classList.remove('recording');
                isRecording = false;
                userInput.placeholder = chatState.step === 4 ? "Digite sua mensagem..." : "Digite sua resposta...";
            };
        } else {
            const micButton = document.getElementById('micButton');
            micButton.disabled = true;
            micButton.title = "Reconhecimento de voz não suportado neste navegador";
        }

        function showMicTooltip() {
            const micButton = document.getElementById('micButton');
            const existingTooltip = micButton.querySelector('.mic-tooltip');
            if (existingTooltip) return; // Prevent multiple tooltips

            const tooltip = document.createElement('div');
            tooltip.classList.add('mic-tooltip');
            tooltip.innerHTML = '<span class="gradient-text">Segure para gravar</span>';
            micButton.appendChild(tooltip);

            setTimeout(() => {
                tooltip.classList.add('fade-out');
                setTimeout(() => {
                    tooltip.remove();
                }, 300); // Match fadeOutTooltip animation duration
            }, 2000);
        }

        function startRecording(event) {
            event.preventDefault(); // Prevent default touch/mouse behavior
            if (!recognition || isRecording || isBotTyping) return;
            pressStartTime = Date.now();
            try {
                recognition.start();
                isRecording = true;
                const micButton = document.getElementById('micButton');
                micButton.classList.add('recording');
                userInput.placeholder = "Gravando... Fale agora!";
            } catch (e) {
                console.error('Error starting recognition:', e);
                isRecording = false;
                const micButton = document.getElementById('micButton');
                micButton.classList.remove('recording');
                userInput.placeholder = chatState.step === 4 ? "Digite sua mensagem..." : "Digite sua resposta...";
                showMicTooltip();
            }
        }

        function stopRecording() {
            if (!recognition || !isRecording) return;
            const pressDuration = Date.now() - pressStartTime;
            const micButton = document.getElementById('micButton');
            isRecording = false;
            micButton.classList.remove('recording');
            userInput.placeholder = chatState.step === 4 ? "Digite sua mensagem..." : "Digite sua resposta...";

            if (pressDuration < 300) {
                recognition.abort();
                showMicTooltip();
            } else {
                recognition.stop();
            }
        }

        const commonGreetings = [
            'oi', 'olá', 'ola', 'bom dia', 'boa tarde', 'boa noite',
            'tudo bem', 'tudo bom', 'como vai', 'e aí', 'e ai', 'eai',
            'oiê', 'oie', 'oiee', 'oláá', 'olaa', 'oláa', 'tô de boa',
            'tô bem', 'tô de boa?', 'tô bem?', 'como você está',
            'como você ta', 'como você tá', 'e você', 'e tu', 'e voce',
            'opa'
        ];

        const botGreetings = [
            'Que bom te ver! 😊',
            'Seja bem-vindo! 😊',
            'É um prazer te conhecer! 😊',
            'Fico feliz em te ajudar hoje! 😊'
        ];

        const correctionKeywords = [
            'errei', 'ops', 'opa', 'eita', 'está errado', 'esta errado',
            'está errada', 'esta errada', 'corrigir', 'alterar', 'trocar',
            'tá errado', 'errado', 'não', 'não sou eu', 'meu nome não é esse',
            'isso está errado', 'o meu nome está errado', 'você escreveu errado',
            'meu nome está digitado errado', 'o nome está errado', 'digitei errado',
            'opa o nome tá errado'
        ];

        const genderCorrectionKeywords = {
            feminine: [
                'sou mulher', 'meu pronome é feminino', 'pode falar no feminino',
                'quero ser tratada como mulher', 'tratada como mulher',
                'sou uma mulher', 'no feminino', 'pronome feminino',
                'prazer em conhecê-la', 'tratada no feminino'
            ],
            masculine: [
                'sou homem', 'meu pronome é masculino', 'pode falar no masculino',
                'quero ser tratado como homem', 'tratado como homem',
                'sou um homem', 'no masculino', 'pronome masculino',
                'prazer em conhecê-lo', 'tratado no masculino'
            ]
        };

        const fieldKeywords = {
            name: ['nome', 'meu nome'],
            email: ['email', 'e-mail', 'mail'],
            whatsapp: ['whatsapp', 'whats', 'telefone', 'número', 'numero']
        };

        function isGreeting(message) {
            const normalizedMessage = message.toLowerCase().trim();
            return commonGreetings.some(greeting => 
                normalizedMessage === greeting || 
                normalizedMessage.startsWith(greeting + ' ') || 
                normalizedMessage.endsWith(' ' + greeting) ||
                normalizedMessage.includes(' ' + greeting + ' ')
            );
        }

        function isValidName(name) {
            const normalizedName = name.trim();
            const nameRegex = /^[a-zA-ZÀ-ÿ\s-]+$/;
            return (
                nameRegex.test(normalizedName) &&
                normalizedName.length <= 50 &&
                !normalizedName.includes(',') &&
                !normalizedName.includes('?') &&
                !normalizedName.includes('!')
            );
        }

        function inferGender(name) {
            const normalizedName = name.toLowerCase().trim();
            // Common feminine endings in Portuguese
            const feminineEndings = ['a', 'e', 'i', 'y'];
            // Common masculine endings
            const masculineEndings = ['o', 'u', 'n', 'r', 's', 'l', 't', 'd'];
            
            const lastChar = normalizedName.slice(-1);
            if (feminineEndings.includes(lastChar)) {
                return 'feminine';
            } else if (masculineEndings.includes(lastChar)) {
                return 'masculine';
            }
            // Default to masculine if unclear (common in Portuguese)
            return 'masculine';
        }

        function extractName(message) {
            const normalizedMessage = message.trim();
            let name = normalizedMessage;

            // Common phrases to remove
            const phrasesToRemove = [
                'meu nome é', 'meu nome e', 'sou', 'sou a', 'sou o',
                'chamo-me', 'me chamo', 'é', 'e', 'oi', 'olá', 'ola',
                'bom dia', 'boa tarde', 'boa noite', 'tudo bem', 'tudo bom',
                'como vai', 'e aí', 'e ai', 'eai', 'oiê', 'oie', 'oiee',
                'oláá', 'olaa', 'oláa', 'tô de boa', 'tô bem', 'opa',
                'tudo bem?', 'tô de boa?', 'tô bem?', 'como você está',
                'como você ta', 'como você tá', 'e você', 'e tu', 'e voce'
            ];

            // Remove common greetings and phrases
            phrasesToRemove.forEach(phrase => {
                const regex = new RegExp(`\\b${phrase}\\b`, 'gi');
                name = name.replace(regex, '').trim();
            });

            // Remove punctuation and extra spaces
            name = name.replace(/[.,!?]/g, '').trim();

            // Capitalize the first letter of each word
            name = name.replace(/\b\w/g, char => char.toUpperCase());

            // If the name contains multiple words, take the first one or the most likely name
            const words = name.split(/\s+/);
            if (words.length > 1) {
                // Assume the name is the last word or the first word after common phrases
                name = words[words.length - 1];
            }

            return name;
        }

        function selectBotGreeting(userGreeting) {
            const normalizedUserGreeting = userGreeting.toLowerCase().trim();
            let availableGreetings = botGreetings;
            const userGreetingWords = normalizedUserGreeting.split(' ');
            availableGreetings = botGreetings.filter(greeting => {
                const greetingWords = greeting.toLowerCase().split(' ');
                return !userGreetingWords.some(word => greetingWords.includes(word));
            });
            if (availableGreetings.length === 0) {
                availableGreetings = botGreetings;
            }
            return availableGreetings[Math.floor(Math.random() * availableGreetings.length)];
        }

        function detectCorrectionRequest(message) {
            const normalizedMessage = message.toLowerCase().trim();
            const isCorrection = correctionKeywords.some(keyword => 
                normalizedMessage.includes(keyword)
            );

            if (!isCorrection) return null;

            // Prioritize name correction if the message explicitly mentions "nome" or is in step 2
            if (fieldKeywords.name.some(keyword => normalizedMessage.includes(keyword)) || chatState.step === 2) {
                return 'name';
            }
            for (const [field, keywords] of Object.entries(fieldKeywords)) {
                if (keywords.some(keyword => normalizedMessage.includes(keyword))) {
                    return field;
                }
            }

            // If no specific field is mentioned but correction keywords are present, assume name in step 2
            if (chatState.step === 2) {
                return 'name';
            }

            return null;
        }

        function detectGenderCorrection(message) {
            const normalizedMessage = message.toLowerCase().trim();
            for (const [gender, keywords] of Object.entries(genderCorrectionKeywords)) {
                if (keywords.some(keyword => normalizedMessage.includes(keyword))) {
                    return gender;
                }
            }
            return null;
        }

        function askForCorrectedData(field) {
            let question;
            switch (field) {
                case 'name':
                    question = "Qual seria o nome correto?";
                    break;
                case 'email':
                    question = "Qual seria o e-mail correto?";
                    break;
                case 'whatsapp':
                    question = "Qual seria o número de WhatsApp correto?";
                    break;
                default:
                    question = "Desculpe, não entendi qual dado você quer corrigir. Pode especificar?";
            }
            showTypingIndicator();
            setTimeout(() => {
                removeTypingIndicator();
                addBotMessage(question);
            }, 2000);
        }

        function continueFlow() {
            showTypingIndicator();
            setTimeout(() => {
                removeTypingIndicator();
                if (chatState.step === 1) {
                    addBotMessage("Olá! Sou o assistente da Good Vibes. 😊 Qual é o seu nome ou como você gostaria de ser chamado?");
                } else if (chatState.step === 2) {
                    const greeting = chatState.gender === 'feminine' ? 
                        `Prazer em conhecê-la, ${chatState.name}!` : 
                        `Prazer em conhecê-lo, ${chatState.name}!`;
                    addBotMessage(`${greeting} Qual é o seu e-mail de contato?`);
                } else if (chatState.step === 3) {
                    addBotMessage("Ótimo! Qual é o seu número de WhatsApp?");
                } else if (chatState.step === 4) {
                    addBotMessage("Perfeito! Agora, qual é a mensagem que você gostaria de enviar?");
                    userInput.placeholder = "Digite sua mensagem...";
                    userInput.rows = 3;
                }
                saveChatState();
            }, 2000);
        }

        window.onload = function() {
            // Clear localStorage and reset chat state
            localStorage.removeItem('chatState');
            chatState = {
                step: 1,
                name: '',
                email: '',
                whatsapp: '',
                message: '',
                gender: null
            };
            hasGreeted = false;
            chatMessages.innerHTML = '';
            const chatContainer = document.querySelector('.chat-container');
            chatContainer.innerHTML = `
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input" id="chatInput">
                    <textarea id="userInput" placeholder="Digite sua resposta..." rows="1" onkeypress="handleKeyPress(event)"></textarea>
                    <button class="mic-button" id="micButton" title="Segure para gravar" onmousedown="startRecording(event)" onmouseup="stopRecording()" ontouchstart="startRecording(event)" ontouchend="stopRecording()">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5zm6 6c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.47 6 6.93V22h2v-3.07c3.39-.46 6-3.4 6-6.93h-2z"/>
                        </svg>
                    </button>
                    <button onclick="sendMessage()">Enviar</button>
                </div>
            `;
            chatMessages = document.getElementById('chatMessages');
            userInput = document.getElementById('userInput');
            // Re-check SpeechRecognition availability after DOM update
            if (!SpeechRecognition) {
                const micButton = document.getElementById('micButton');
                micButton.disabled = true;
                micButton.title = "Reconhecimento de voz não suportado neste navegador";
            }
        };

        function saveChatState() {
            localStorage.setItem('chatState', JSON.stringify(chatState));
        }

        function addBotMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', 'bot-message');
            messageElement.textContent = message;
            chatMessages.appendChild(messageElement);
            scrollToBottom();
        }

        function addUserMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', 'user-message');
            messageElement.textContent = message;
            chatMessages.appendChild(messageElement);
            scrollToBottom();
        }

        function showTypingIndicator() {
            const typingElement = document.createElement('div');
            typingElement.classList.add('typing-indicator');
            typingElement.innerHTML = '<span></span><span></span><span></span>';
            typingElement.id = 'typingIndicator';
            chatMessages.appendChild(typingElement);
            scrollToBottom();
            isBotTyping = true;
        }

        function removeTypingIndicator() {
            const typingElement = document.getElementById('typingIndicator');
            if (typingElement) {
                typingElement.remove();
            }
            isBotTyping = false;
        }

        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function isValidPhoneNumber(phone) {
            const phoneRegex = /^\+?[\d\s()-]{7,}$/;
            return phoneRegex.test(phone);
        }

        const contactSectionObserver = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting && !hasGreeted && chatState.step === 1 && !chatState.name) {
                    console.log("Contact section is visible, triggering greeting...");
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Olá! Sou o assistente da Good Vibes. 😊 Qual é o seu nome ou como você gostaria de ser chamado?");
                        hasGreeted = true;
                        saveChatState();
                    }, 3000);
                }
            });
        }, { threshold: 0.3 });

        function sendMessage() {
            if (isBotTyping) return;

            const userText = userInput.value.trim();
            if (!userText) return;

            // Check for gender correction
            const requestedGender = detectGenderCorrection(userText);
            if (requestedGender && chatState.step <= 2) {
                addUserMessage(userText);
                chatState.gender = requestedGender;
                showTypingIndicator();
                setTimeout(() => {
                    removeTypingIndicator();
                    const greeting = requestedGender === 'feminine' ? 
                        `Entendido! Prazer em conhecê-la, ${chatState.name || 'você'}!` : 
                        `Entendido! Prazer em conhecê-lo, ${chatState.name || 'você'}!`;
                    addBotMessage(`${greeting} ${chatState.step === 1 ? 'Qual é o seu nome ou como você gostaria de ser chamado?' : 'Qual é o seu e-mail de contato?'}`);
                    saveChatState();
                }, 2000);
                userInput.value = '';
                return;
            }

            const correctionField = detectCorrectionRequest(userText);
            if (correctionField && chatState.step < 5) {
                addUserMessage(userText);
                fieldToCorrect = correctionField;
                isCorrecting = true;
                askForCorrectedData(correctionField);
                userInput.value = '';
                return;
            }

            if (isCorrecting) {
                addUserMessage(userText);
                let isValid = true;
                let errorMessage = '';

                if (fieldToCorrect === 'name') {
                    if (isValidName(userText)) {
                        chatState.name = userText;
                        // Re-infer gender unless user has specified one
                        if (!chatState.gender) {
                            chatState.gender = inferGender(userText);
                        }
                    } else {
                        isValid = false;
                        errorMessage = "Desculpe, não sei se esse é o seu nome. 😅 Pode me dizer um nome válido?";
                    }
                } else if (fieldToCorrect === 'email') {
                    if (isValidEmail(userText)) {
                        chatState.email = userText;
                    } else {
                        isValid = false;
                        errorMessage = "Desculpe, isso não parece ser um e-mail válido. Por favor, insira um e-mail válido (exemplo: seuemail@dominio.com).";
                    }
                } else if (fieldToCorrect === 'whatsapp') {
                    if (isValidPhoneNumber(userText)) {
                        chatState.whatsapp = userText;
                    } else {
                        isValid = false;
                        errorMessage = "Desculpe, isso não parece ser um número de telefone válido. Por favor, insira um número de WhatsApp válido (exemplo: +5511999999999).";
                    }
                }

                if (isValid) {
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Dado corrigido com sucesso! 😊");
                        isCorrecting = false;
                        fieldToCorrect = null;
                        continueFlow();
                    }, 2000);
                } else {
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage(errorMessage);
                    }, 2000);
                }
                userInput.value = '';
                saveChatState();
                return;
            }

            if (chatState.step === 1) {
                addUserMessage(userText);
                const extractedName = extractName(userText);
                if (isValidName(extractedName)) {
                    chatState.name = extractedName;
                    chatState.gender = inferGender(extractedName);
                    chatState.step = 2;
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        const greeting = chatState.gender === 'feminine' ? 
                            `Prazer em conhecê-la, ${chatState.name}!` : 
                            `Prazer em conhecê-lo, ${chatState.name}!`;
                        addBotMessage(`${greeting} Qual é o seu e-mail de contato?`);
                        saveChatState();
                    }, 3000);
                } else if (isGreeting(userText)) {
                    const botGreeting = selectBotGreeting(userText);
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage(`${botGreeting} Qual é o seu nome ou como você gostaria de ser chamado?`);
                    }, 3000);
                } else {
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Desculpe, não sei se esse é o seu nome. 😅 Pode me dizer seu nome ou como você gostaria de ser chamado?");
                    }, 3000);
                }
            } else if (chatState.step === 2) {
                addUserMessage(userText);
                if (isValidEmail(userText)) {
                    chatState.email = userText;
                    chatState.step = 3;
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Ótimo! Qual é o seu número de WhatsApp?");
                        saveChatState();
                    }, 3000);
                } else {
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Desculpe, isso não parece ser um e-mail válido. Por favor, insira um e-mail válido (exemplo: seuemail@dominio.com).");
                    }, 3000);
                }
            } else if (chatState.step === 3) {
                addUserMessage(userText);
                if (isValidPhoneNumber(userText)) {
                    chatState.whatsapp = userText;
                    chatState.step = 4;
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Perfeito! Agora, qual é a mensagem que você gostaria de enviar?");
                        userInput.placeholder = "Digite sua mensagem...";
                        userInput.rows = 3;
                        saveChatState();
                    }, 3000);
                } else {
                    showTypingIndicator();
                    setTimeout(() => {
                        removeTypingIndicator();
                        addBotMessage("Desculpe, isso não parece ser um número de telefone válido. Por favor, insira um número de WhatsApp válido (exemplo: +5511999999999).");
                    }, 3000);
                }
            } else if (chatState.step === 4) {
                chatState.message = userText;
                addUserMessage(userText);
                chatState.step = 5;
                sendToFormspree();
            }

            userInput.value = '';
            saveChatState();
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function sendToFormspree() {
            const formData = new FormData();
            formData.append('name', chatState.name);
            formData.append('email', chatState.email);
            formData.append('whatsapp', chatState.whatsapp);
            formData.append('message', chatState.message);

            fetch('https://formspree.io/f/mgvolbyv', {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            })
            .then(response => {
                if (response.ok) {
                    console.log("Formspree request successful:", response);
                    showSuccessMessage();
                } else {
                    console.error("Formspree request failed:", response.status, response.statusText);
                    addBotMessage("Desculpe, houve um erro ao enviar sua mensagem. Tente novamente mais tarde.");
                }
            })
            .catch(error => {
                console.error("Formspree request error:", error);
                addBotMessage("Desculpe, houve um erro ao enviar sua mensagem. Tente novamente mais tarde.");
            });
        }

        function showSuccessMessage() {
            chatMessages.innerHTML = '';
            const chatContainer = document.querySelector('.chat-container');
            chatContainer.classList.add('success');
            chatContainer.innerHTML = `
                <div class="chat-messages" id="chatMessages">
                    <div class="sparkle-text">Mensagem Enviada! ✨</div>
                </div>
            `;
            chatMessages = document.getElementById('chatMessages');
            localStorage.removeItem('chatState');
            chatState = {
                step: 1,
                name: '',
                email: '',
                whatsapp: '',
                message: '',
                gender: null
            };
        }

        document.addEventListener('DOMContentLoaded', () => {
            const contactSection = document.querySelector('#contact');
            if (contactSection) {
                contactSectionObserver.observe(contactSection);
                console.log("IntersectionObserver started for contact section.");
            } else {
                console.error("Contact section not found!");
            }
        });
    </script>
</body>
</html>
